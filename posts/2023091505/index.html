<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="初认识 基本使用 1、添加基本依赖 2、 @EnableScheduling 注解开启定时任务 @Scheduled 注释标注定时任务方法 通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过task:ann"><title>Spring Task定时任务</title><link rel=canonical href=https://www.catguild.cn/posts/2023091505/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Spring Task定时任务"><meta property="og:description" content="初认识 基本使用 1、添加基本依赖 2、 @EnableScheduling 注解开启定时任务 @Scheduled 注释标注定时任务方法 通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过task:ann"><meta property="og:url" content="https://www.catguild.cn/posts/2023091505/"><meta property="og:site_name" content="雪乃の猫"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:published_time" content="2023-09-15T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-15T00:00:00+00:00"><meta name=twitter:title content="Spring Task定时任务"><meta name=twitter:description content="初认识 基本使用 1、添加基本依赖 2、 @EnableScheduling 注解开启定时任务 @Scheduled 注释标注定时任务方法 通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过task:ann"><link rel="shortcut icon" href=/img/main.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-49K5GYEZX0"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-49K5GYEZX0")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?6e15f273a2871fda1150e7f434efa838",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3411292260463335" crossorigin=anonymous></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/title_hu1ecbcbed4019d04623d15304c3b97c82_4860_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>雪乃の猫</a></h1><h2 class=site-description>猫是可爱的，狼是很帅的，就是说，孤独又可爱又帅</h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><span>⏱时间轴</span></a></li><li><a href=/categories/><span>📚分类</span></a></li><li><a href=/tags/><span>🔖标签</span></a></li><li><a href=/search/><span>🔍搜索</span></a></li><li><a href=/links/><span>🤝友链</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#基本使用>基本使用</a><ul><li></li></ul></li><li><a href=#三种触发器>三种触发器</a><ul><li><a href=#实际运行一下>实际运行一下</a></li><li><a href=#为什么会这样>为什么会这样</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/2023091505/>Spring Task定时任务</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 15, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 10 分钟</time></div></footer></div></header><section class=article-content><h1 id=初认识>初认识</h1><h2 id=基本使用>基本使用</h2><h4 id=1添加基本依赖>1、添加基本依赖</h4><h4 id=2>2、</h4><p>@EnableScheduling 注解开启定时任务</p><p>@Scheduled 注释标注定时任务方法</p><p>通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过<a class=link href=task:annotation-driven/>task:annotation-driven/</a>XML元素或@EnableScheduling annotation来完成。</p><h2 id=三种触发器>三种触发器</h2><h3 id=实际运行一下>实际运行一下</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.scheduling.annotation.EnableScheduling<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.scheduling.annotation.Scheduled<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author xiyan
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date 2023/7/5 14:36
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableScheduling</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DemoScheduledTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 固定延迟时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔 5s ，执行 3s、实际间隔8s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:36:05.068
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:36:13.091
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:36:21.109
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:36:29.134
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:36:37.149
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔 5s ，执行 5s、实际间隔10s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:38:46.182
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:38:56.196
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:39:06.210
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:39:16.235
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:39:26.244
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔 5s ，执行 7s、实际间隔12s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:45:02.764
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:45:14.775
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:45:26.796
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:45:38.814
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:45:50.830
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 下次执行时间=上次执行时间+(fixedDelay时间+执行耗时)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Scheduled</span><span style=color:#f92672>(</span>fixedDelay <span style=color:#f92672>=</span> <span style=color:#ae81ff>5000</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test1</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test1方法执行=====&gt;&gt;&gt;&gt;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>3000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 固定间隔时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔5s、执行3s、实际间隔5s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 18:00:11.362
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 18:00:16.352
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 18:00:21.358
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 18:00:26.355
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 18:00:31.364
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔 5s ，执行 5s、实际间隔5s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:40:39.180
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:40:44.185
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:40:49.200
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:40:54.212
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:40:59.226
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔5s，执行7s、实际间隔7s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:41:45.559
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:41:52.567
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:41:59.581
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:42:06.588
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-05 14:42:13.593
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 下次执行时间=上次执行时间+ max(fixedRate, 执行耗时)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Scheduled</span><span style=color:#f92672>(</span>fixedRate <span style=color:#f92672>=</span> <span style=color:#ae81ff>5000</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test2</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test2方法执行=====&gt;&gt;&gt;&gt;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>3000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * cron表达式
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔5s、执行3s、实际间隔5s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:55:10.015
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:55:15.001
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:55:20.014
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:55:25.007
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:55:30.008
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔 5s ，执行 5s、实际间隔10s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:49:55.008
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:50:05.014
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:50:15.000
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:50:25.004
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:50:35.005
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 间隔5s，执行7s、实际间隔10s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:51:55.016
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:52:05.008
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:52:15.001
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:52:25.010
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2023-07-06 17:52:35.014
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 下次执行时间=如果到达定时时间，上一个任务已完成，将会执行，否则会跳过
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Scheduled</span><span style=color:#f92672>(</span>cron <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0/5 * * * * ?&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test3</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test3方法执行=====&gt;&gt;&gt;&gt;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>5000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=为什么会这样>为什么会这样</h3><h1 id=运行原理>运行原理</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>Bean后处理器，注册用@Scheduled注释的方法，以便由TaskScheduler根据通过注释提供的“fixedRate”、“fixedDelay”或“cron”表达式调用。
</span></span></span><span style=display:flex><span><span style=color:#75715e>这个后处理器由Spring的&lt;task:annotation-driven&gt;XML元素以及@EnableScheduling注释自动注册。
</span></span></span><span style=display:flex><span><span style=color:#75715e>自动检测容器中的任何SchedulingConfigurer实例，允许自定义要使用的计划程序或对任务注册进行细粒度控制（例如，注册触发器任务）。
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>springframework</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduling</span><span style=color:#f92672>.</span><span style=color:#a6e22e>annotation</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ScheduledAnnotationBeanPostProcessor</span>
</span></span></code></pre></div><p>关键类</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Bean post-processor that registers methods annotated with
</span></span></span><span style=display:flex><span><span style=color:#75715e> * {@link Scheduled @Scheduled} to be invoked by a
</span></span></span><span style=display:flex><span><span style=color:#75715e> * {@link org.springframework.scheduling.TaskScheduler} according to the
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &#34;fixedRate&#34;, &#34;fixedDelay&#34;, or &#34;cron&#34; expression provided via the annotation.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;This post-processor is automatically registered by Spring&#39;s
</span></span></span><span style=display:flex><span><span style=color:#75715e> * {@code &lt;task:annotation-driven&gt;} XML element, and also by the
</span></span></span><span style=display:flex><span><span style=color:#75715e> * {@link EnableScheduling @EnableScheduling} annotation.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;Autodetects any {@link SchedulingConfigurer} instances in the container,
</span></span></span><span style=display:flex><span><span style=color:#75715e> * allowing for customization of the scheduler to be used or for fine-grained
</span></span></span><span style=display:flex><span><span style=color:#75715e> * control over task registration (e.g. registration of {@link Trigger} tasks).
</span></span></span><span style=display:flex><span><span style=color:#75715e> * See the {@link EnableScheduling @EnableScheduling} javadocs for complete usage
</span></span></span><span style=display:flex><span><span style=color:#75715e> * details.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Mark Fisher
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Juergen Hoeller
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Chris Beams
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Elizabeth Chatman
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Victor Brown
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Sam Brannen
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @since 3.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see Scheduled
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see EnableScheduling
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see SchedulingConfigurer
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see org.springframework.scheduling.TaskScheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see org.springframework.scheduling.config.ScheduledTaskRegistrar
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see AsyncAnnotationBeanPostProcessor
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ScheduledAnnotationBeanPostProcessor</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>implements</span> ScheduledTaskHolder<span style=color:#f92672>,</span> MergedBeanDefinitionPostProcessor<span style=color:#f92672>,</span> DestructionAwareBeanPostProcessor<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>		Ordered<span style=color:#f92672>,</span> EmbeddedValueResolverAware<span style=color:#f92672>,</span> BeanNameAware<span style=color:#f92672>,</span> BeanFactoryAware<span style=color:#f92672>,</span> ApplicationContextAware<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>		SmartInitializingSingleton<span style=color:#f92672>,</span> ApplicationListener<span style=color:#f92672>&lt;</span>ContextRefreshedEvent<span style=color:#f92672>&gt;,</span> DisposableBean <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * The default name of the {@link TaskScheduler} bean to pick up: {@value}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * &lt;p&gt;Note that the initial lookup happens by type; this is just the fallback
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * in case of multiple scheduler beans found in the context.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String DEFAULT_TASK_SCHEDULER_BEAN_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;taskScheduler&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>final</span> Log logger <span style=color:#f92672>=</span> LogFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getLog</span><span style=color:#f92672>(</span>getClass<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ScheduledTaskRegistrar registrar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> Object scheduler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> StringValueResolver embeddedValueResolver<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> String beanName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> BeanFactory beanFactory<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> ApplicationContext applicationContext<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Set<span style=color:#f92672>&lt;</span>Class<span style=color:#f92672>&lt;?&gt;&gt;</span> nonAnnotatedClasses <span style=color:#f92672>=</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>newSetFromMap</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ConcurrentHashMap<span style=color:#f92672>&lt;&gt;(</span><span style=color:#ae81ff>64</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;&gt;</span> scheduledTasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IdentityHashMap<span style=color:#f92672>&lt;&gt;(</span><span style=color:#ae81ff>16</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Create a default {@code ScheduledAnnotationBeanPostProcessor}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ScheduledAnnotationBeanPostProcessor</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ScheduledTaskRegistrar<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Create a {@code ScheduledAnnotationBeanPostProcessor} delegating to the
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * specified {@link ScheduledTaskRegistrar}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param registrar the ScheduledTaskRegistrar to register {@code @Scheduled}
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * tasks on
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 5.1
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ScheduledAnnotationBeanPostProcessor</span><span style=color:#f92672>(</span>ScheduledTaskRegistrar registrar<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>notNull</span><span style=color:#f92672>(</span>registrar<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;ScheduledTaskRegistrar is required&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span> <span style=color:#f92672>=</span> registrar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getOrder</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> LOWEST_PRECEDENCE<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Set the {@link org.springframework.scheduling.TaskScheduler} that will invoke
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * the scheduled methods, or a {@link java.util.concurrent.ScheduledExecutorService}
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * to be wrapped as a TaskScheduler.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * &lt;p&gt;If not specified, default scheduler resolution will apply: searching for a
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * unique {@link TaskScheduler} bean in the context, or for a {@link TaskScheduler}
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * bean named &#34;taskScheduler&#34; otherwise; the same lookup will also be performed for
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * a {@link ScheduledExecutorService} bean. If neither of the two is resolvable,
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * a local single-threaded default scheduler will be created within the registrar.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see #DEFAULT_TASK_SCHEDULER_BEAN_NAME
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setScheduler</span><span style=color:#f92672>(</span>Object scheduler<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduler</span> <span style=color:#f92672>=</span> scheduler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setEmbeddedValueResolver</span><span style=color:#f92672>(</span>StringValueResolver resolver<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span> <span style=color:#f92672>=</span> resolver<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setBeanName</span><span style=color:#f92672>(</span>String beanName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanName</span> <span style=color:#f92672>=</span> beanName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Making a {@link BeanFactory} available is optional; if not set,
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * {@link SchedulingConfigurer} beans won&#39;t get autodetected and
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * a {@link #setScheduler scheduler} has to be explicitly configured.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setBeanFactory</span><span style=color:#f92672>(</span>BeanFactory beanFactory<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span> <span style=color:#f92672>=</span> beanFactory<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Setting an {@link ApplicationContext} is optional: If set, registered
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * tasks will be activated in the {@link ContextRefreshedEvent} phase;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * if not set, it will happen at {@link #afterSingletonsInstantiated} time.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setApplicationContext</span><span style=color:#f92672>(</span>ApplicationContext applicationContext<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>applicationContext</span> <span style=color:#f92672>=</span> applicationContext<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span> <span style=color:#f92672>=</span> applicationContext<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>afterSingletonsInstantiated</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Remove resolved singleton classes from cache
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>nonAnnotatedClasses</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clear</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>applicationContext</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Not running in an ApplicationContext -&gt; register tasks early...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			finishRegistration<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onApplicationEvent</span><span style=color:#f92672>(</span>ContextRefreshedEvent event<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>event<span style=color:#f92672>.</span><span style=color:#a6e22e>getApplicationContext</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>applicationContext</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Running in an ApplicationContext -&gt; register tasks this late...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>// giving other ContextRefreshedEvent listeners a chance to perform
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>// their work at the same time (e.g. Spring Batch&#39;s job registration).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			finishRegistration<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * 关键的注册逻辑
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>finishRegistration</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduler</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setScheduler</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduler</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>		<span style=color:#75715e>// 解析实现了 SchedulingConfigurer 接口的注册类，编程式任务注册
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span> <span style=color:#66d9ef>instanceof</span> ListableBeanFactory<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> SchedulingConfigurer<span style=color:#f92672>&gt;</span> beans <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>((</span>ListableBeanFactory<span style=color:#f92672>)</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getBeansOfType</span><span style=color:#f92672>(</span>SchedulingConfigurer<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			List<span style=color:#f92672>&lt;</span>SchedulingConfigurer<span style=color:#f92672>&gt;</span> configurers <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;(</span>beans<span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			AnnotationAwareOrderComparator<span style=color:#f92672>.</span><span style=color:#a6e22e>sort</span><span style=color:#f92672>(</span>configurers<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>SchedulingConfigurer configurer <span style=color:#f92672>:</span> configurers<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				configurer<span style=color:#f92672>.</span><span style=color:#a6e22e>configureTasks</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 如果注册器中有任务，则注册任务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>hasTasks</span><span style=color:#f92672>()</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getScheduler</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>state</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;BeanFactory must be set to find scheduler by type&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Search for TaskScheduler bean...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setTaskScheduler</span><span style=color:#f92672>(</span>resolveSchedulerBean<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span><span style=color:#f92672>,</span> TaskScheduler<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoUniqueBeanDefinitionException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isTraceEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					logger<span style=color:#f92672>.</span><span style=color:#a6e22e>trace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Could not find unique TaskScheduler bean - attempting to resolve by name: &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>							ex<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setTaskScheduler</span><span style=color:#f92672>(</span>resolveSchedulerBean<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span><span style=color:#f92672>,</span> TaskScheduler<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchBeanDefinitionException ex2<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isInfoEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						logger<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;More than one TaskScheduler bean exists within the context, and &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>								<span style=color:#e6db74>&#34;none is named &#39;taskScheduler&#39;. Mark one of them as primary or name it &#39;taskScheduler&#39; &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>								<span style=color:#e6db74>&#34;(possibly as an alias); or implement the SchedulingConfigurer interface and call &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>								<span style=color:#e6db74>&#34;ScheduledTaskRegistrar#setScheduler explicitly within the configureTasks() callback: &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>								ex<span style=color:#f92672>.</span><span style=color:#a6e22e>getBeanNamesFound</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchBeanDefinitionException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isTraceEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					logger<span style=color:#f92672>.</span><span style=color:#a6e22e>trace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Could not find default TaskScheduler bean - attempting to find ScheduledExecutorService: &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>							ex<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Search for ScheduledExecutorService bean next...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setScheduler</span><span style=color:#f92672>(</span>resolveSchedulerBean<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span><span style=color:#f92672>,</span> ScheduledExecutorService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoUniqueBeanDefinitionException ex2<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isTraceEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						logger<span style=color:#f92672>.</span><span style=color:#a6e22e>trace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Could not find unique ScheduledExecutorService bean - attempting to resolve by name: &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>								ex2<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setScheduler</span><span style=color:#f92672>(</span>resolveSchedulerBean<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span><span style=color:#f92672>,</span> ScheduledExecutorService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchBeanDefinitionException ex3<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isInfoEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>							logger<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;More than one ScheduledExecutorService bean exists within the context, and &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>									<span style=color:#e6db74>&#34;none is named &#39;taskScheduler&#39;. Mark one of them as primary or name it &#39;taskScheduler&#39; &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>									<span style=color:#e6db74>&#34;(possibly as an alias); or implement the SchedulingConfigurer interface and call &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>									<span style=color:#e6db74>&#34;ScheduledTaskRegistrar#setScheduler explicitly within the configureTasks() callback: &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>									ex2<span style=color:#f92672>.</span><span style=color:#a6e22e>getBeanNamesFound</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchBeanDefinitionException ex2<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isTraceEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						logger<span style=color:#f92672>.</span><span style=color:#a6e22e>trace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Could not find default ScheduledExecutorService bean - falling back to default: &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>								ex2<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#75715e>// Giving up -&gt; falling back to default scheduler within the registrar...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>					logger<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;No TaskScheduler/ScheduledExecutorService bean found for scheduled processing&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>afterPropertiesSet</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>resolveSchedulerBean</span><span style=color:#f92672>(</span>BeanFactory beanFactory<span style=color:#f92672>,</span> Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> schedulerType<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> byName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>byName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			T scheduler <span style=color:#f92672>=</span> beanFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getBean</span><span style=color:#f92672>(</span>DEFAULT_TASK_SCHEDULER_BEAN_NAME<span style=color:#f92672>,</span> schedulerType<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanName</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span> <span style=color:#66d9ef>instanceof</span> ConfigurableBeanFactory<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>((</span>ConfigurableBeanFactory<span style=color:#f92672>)</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanFactory</span><span style=color:#f92672>).</span><span style=color:#a6e22e>registerDependentBean</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>						DEFAULT_TASK_SCHEDULER_BEAN_NAME<span style=color:#f92672>,</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanName</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> scheduler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>beanFactory <span style=color:#66d9ef>instanceof</span> AutowireCapableBeanFactory<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			NamedBeanHolder<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> holder <span style=color:#f92672>=</span> <span style=color:#f92672>((</span>AutowireCapableBeanFactory<span style=color:#f92672>)</span> beanFactory<span style=color:#f92672>).</span><span style=color:#a6e22e>resolveNamedBean</span><span style=color:#f92672>(</span>schedulerType<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanName</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> beanFactory <span style=color:#66d9ef>instanceof</span> ConfigurableBeanFactory<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>((</span>ConfigurableBeanFactory<span style=color:#f92672>)</span> beanFactory<span style=color:#f92672>).</span><span style=color:#a6e22e>registerDependentBean</span><span style=color:#f92672>(</span>holder<span style=color:#f92672>.</span><span style=color:#a6e22e>getBeanName</span><span style=color:#f92672>(),</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beanName</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> holder<span style=color:#f92672>.</span><span style=color:#a6e22e>getBeanInstance</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> beanFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getBean</span><span style=color:#f92672>(</span>schedulerType<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>postProcessMergedBeanDefinition</span><span style=color:#f92672>(</span>RootBeanDefinition beanDefinition<span style=color:#f92672>,</span> Class<span style=color:#f92672>&lt;?&gt;</span> beanType<span style=color:#f92672>,</span> String beanName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>postProcessBeforeInitialization</span><span style=color:#f92672>(</span>Object bean<span style=color:#f92672>,</span> String beanName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> bean<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>postProcessAfterInitialization</span><span style=color:#f92672>(</span>Object bean<span style=color:#f92672>,</span> String beanName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bean <span style=color:#66d9ef>instanceof</span> AopInfrastructureBean <span style=color:#f92672>||</span> bean <span style=color:#66d9ef>instanceof</span> TaskScheduler <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>				bean <span style=color:#66d9ef>instanceof</span> ScheduledExecutorService<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Ignore AOP infrastructure such as scoped proxies.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>return</span> bean<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		Class<span style=color:#f92672>&lt;?&gt;</span> targetClass <span style=color:#f92672>=</span> AopProxyUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>ultimateTargetClass</span><span style=color:#f92672>(</span>bean<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>nonAnnotatedClasses</span><span style=color:#f92672>.</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span>targetClass<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>				AnnotationUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isCandidateClass</span><span style=color:#f92672>(</span>targetClass<span style=color:#f92672>,</span> Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>asList</span><span style=color:#f92672>(</span>Scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> Schedules<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			Map<span style=color:#f92672>&lt;</span>Method<span style=color:#f92672>,</span> Set<span style=color:#f92672>&lt;</span>Scheduled<span style=color:#f92672>&gt;&gt;</span> annotatedMethods <span style=color:#f92672>=</span> MethodIntrospector<span style=color:#f92672>.</span><span style=color:#a6e22e>selectMethods</span><span style=color:#f92672>(</span>targetClass<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>(</span>MethodIntrospector<span style=color:#f92672>.</span><span style=color:#a6e22e>MetadataLookup</span><span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>Scheduled<span style=color:#f92672>&gt;&gt;)</span> method <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						Set<span style=color:#f92672>&lt;</span>Scheduled<span style=color:#f92672>&gt;</span> scheduledAnnotations <span style=color:#f92672>=</span> AnnotatedElementUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>getMergedRepeatableAnnotations</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>								method<span style=color:#f92672>,</span> Scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> Schedules<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>return</span> <span style=color:#f92672>(!</span>scheduledAnnotations<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>()</span> <span style=color:#f92672>?</span> scheduledAnnotations <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>annotatedMethods<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>nonAnnotatedClasses</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>targetClass<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isTraceEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					logger<span style=color:#f92672>.</span><span style=color:#a6e22e>trace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;No @Scheduled annotations found on bean class: &#34;</span> <span style=color:#f92672>+</span> targetClass<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Non-empty set of methods
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				annotatedMethods<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>((</span>method<span style=color:#f92672>,</span> scheduledAnnotations<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>						scheduledAnnotations<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span>scheduled <span style=color:#f92672>-&gt;</span> processScheduled<span style=color:#f92672>(</span>scheduled<span style=color:#f92672>,</span> method<span style=color:#f92672>,</span> bean<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>logger<span style=color:#f92672>.</span><span style=color:#a6e22e>isTraceEnabled</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					logger<span style=color:#f92672>.</span><span style=color:#a6e22e>trace</span><span style=color:#f92672>(</span>annotatedMethods<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; @Scheduled methods processed on bean &#39;&#34;</span> <span style=color:#f92672>+</span> beanName <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>							<span style=color:#e6db74>&#34;&#39;: &#34;</span> <span style=color:#f92672>+</span> annotatedMethods<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> bean<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Process the given {@code @Scheduled} method declaration on the given bean.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param scheduled the {@code @Scheduled} annotation
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param method the method that the annotation has been declared on
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param bean the target bean instance
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see #createRunnable(Object, Method)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>processScheduled</span><span style=color:#f92672>(</span>Scheduled scheduled<span style=color:#f92672>,</span> Method method<span style=color:#f92672>,</span> Object bean<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			Runnable runnable <span style=color:#f92672>=</span> createRunnable<span style=color:#f92672>(</span>bean<span style=color:#f92672>,</span> method<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>boolean</span> processedSchedule <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>			String errorMessage <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>					<span style=color:#e6db74>&#34;Exactly one of the &#39;cron&#39;, &#39;fixedDelay(String)&#39;, or &#39;fixedRate(String)&#39; attributes is required&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> tasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedHashSet<span style=color:#f92672>&lt;&gt;(</span><span style=color:#ae81ff>4</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Determine initial delay
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>long</span> initialDelay <span style=color:#f92672>=</span> convertToMillis<span style=color:#f92672>(</span>scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>initialDelay</span><span style=color:#f92672>(),</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>timeUnit</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			String initialDelayString <span style=color:#f92672>=</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>initialDelayString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasText</span><span style=color:#f92672>(</span>initialDelayString<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(</span>initialDelay <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Specify &#39;initialDelay&#39; or &#39;initialDelayString&#39;, not both&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					initialDelayString <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span><span style=color:#f92672>.</span><span style=color:#a6e22e>resolveStringValue</span><span style=color:#f92672>(</span>initialDelayString<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasLength</span><span style=color:#f92672>(</span>initialDelayString<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						initialDelay <span style=color:#f92672>=</span> convertToMillis<span style=color:#f92672>(</span>initialDelayString<span style=color:#f92672>,</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>timeUnit</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>RuntimeException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>								<span style=color:#e6db74>&#34;Invalid initialDelayString value \&#34;&#34;</span> <span style=color:#f92672>+</span> initialDelayString <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;\&#34; - cannot parse into long&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Check cron expression
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			String cron <span style=color:#f92672>=</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>cron</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasText</span><span style=color:#f92672>(</span>cron<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				String zone <span style=color:#f92672>=</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>zone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					cron <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span><span style=color:#f92672>.</span><span style=color:#a6e22e>resolveStringValue</span><span style=color:#f92672>(</span>cron<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					zone <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span><span style=color:#f92672>.</span><span style=color:#a6e22e>resolveStringValue</span><span style=color:#f92672>(</span>zone<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasLength</span><span style=color:#f92672>(</span>cron<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(</span>initialDelay <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;&#39;initialDelay&#39; not supported for cron triggers&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					processedSchedule <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>Scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>CRON_DISABLED</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>cron<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						TimeZone timeZone<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasText</span><span style=color:#f92672>(</span>zone<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>							timeZone <span style=color:#f92672>=</span> StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>parseTimeZoneString</span><span style=color:#f92672>(</span>zone<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>							timeZone <span style=color:#f92672>=</span> TimeZone<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>						tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleCronTask</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> CronTask<span style=color:#f92672>(</span>runnable<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> CronTrigger<span style=color:#f92672>(</span>cron<span style=color:#f92672>,</span> timeZone<span style=color:#f92672>))));</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// At this point we don&#39;t need to differentiate between initial delay set or not anymore
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>initialDelay <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				initialDelay <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Check fixed delay
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>long</span> fixedDelay <span style=color:#f92672>=</span> convertToMillis<span style=color:#f92672>(</span>scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelay</span><span style=color:#f92672>(),</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>timeUnit</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>fixedDelay <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(!</span>processedSchedule<span style=color:#f92672>,</span> errorMessage<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				processedSchedule <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>				tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleFixedDelayTask</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> FixedDelayTask<span style=color:#f92672>(</span>runnable<span style=color:#f92672>,</span> fixedDelay<span style=color:#f92672>,</span> initialDelay<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			String fixedDelayString <span style=color:#f92672>=</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasText</span><span style=color:#f92672>(</span>fixedDelayString<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					fixedDelayString <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span><span style=color:#f92672>.</span><span style=color:#a6e22e>resolveStringValue</span><span style=color:#f92672>(</span>fixedDelayString<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasLength</span><span style=color:#f92672>(</span>fixedDelayString<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(!</span>processedSchedule<span style=color:#f92672>,</span> errorMessage<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					processedSchedule <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						fixedDelay <span style=color:#f92672>=</span> convertToMillis<span style=color:#f92672>(</span>fixedDelayString<span style=color:#f92672>,</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>timeUnit</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>RuntimeException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>								<span style=color:#e6db74>&#34;Invalid fixedDelayString value \&#34;&#34;</span> <span style=color:#f92672>+</span> fixedDelayString <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;\&#34; - cannot parse into long&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleFixedDelayTask</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> FixedDelayTask<span style=color:#f92672>(</span>runnable<span style=color:#f92672>,</span> fixedDelay<span style=color:#f92672>,</span> initialDelay<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Check fixed rate
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>long</span> fixedRate <span style=color:#f92672>=</span> convertToMillis<span style=color:#f92672>(</span>scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRate</span><span style=color:#f92672>(),</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>timeUnit</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>fixedRate <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(!</span>processedSchedule<span style=color:#f92672>,</span> errorMessage<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				processedSchedule <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>				tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleFixedRateTask</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> FixedRateTask<span style=color:#f92672>(</span>runnable<span style=color:#f92672>,</span> fixedRate<span style=color:#f92672>,</span> initialDelay<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			String fixedRateString <span style=color:#f92672>=</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasText</span><span style=color:#f92672>(</span>fixedRateString<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					fixedRateString <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>embeddedValueResolver</span><span style=color:#f92672>.</span><span style=color:#a6e22e>resolveStringValue</span><span style=color:#f92672>(</span>fixedRateString<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasLength</span><span style=color:#f92672>(</span>fixedRateString<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(!</span>processedSchedule<span style=color:#f92672>,</span> errorMessage<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					processedSchedule <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						fixedRate <span style=color:#f92672>=</span> convertToMillis<span style=color:#f92672>(</span>fixedRateString<span style=color:#f92672>,</span> scheduled<span style=color:#f92672>.</span><span style=color:#a6e22e>timeUnit</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>RuntimeException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>								<span style=color:#e6db74>&#34;Invalid fixedRateString value \&#34;&#34;</span> <span style=color:#f92672>+</span> fixedRateString <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;\&#34; - cannot parse into long&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleFixedRateTask</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> FixedRateTask<span style=color:#f92672>(</span>runnable<span style=color:#f92672>,</span> fixedRate<span style=color:#f92672>,</span> initialDelay<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Check whether we had any attribute set
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(</span>processedSchedule<span style=color:#f92672>,</span> errorMessage<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Finally register the scheduled tasks
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> regTasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>computeIfAbsent</span><span style=color:#f92672>(</span>bean<span style=color:#f92672>,</span> key <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>new</span> LinkedHashSet<span style=color:#f92672>&lt;&gt;(</span><span style=color:#ae81ff>4</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>				regTasks<span style=color:#f92672>.</span><span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>tasks<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IllegalArgumentException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalStateException<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>					<span style=color:#e6db74>&#34;Encountered invalid @Scheduled method &#39;&#34;</span> <span style=color:#f92672>+</span> method<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;: &#34;</span> <span style=color:#f92672>+</span> ex<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Create a {@link Runnable} for the given bean instance,
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * calling the specified scheduled method.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * &lt;p&gt;The default implementation creates a {@link ScheduledMethodRunnable}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param target the target bean instance
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param method the scheduled method to call
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 5.1
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see ScheduledMethodRunnable#ScheduledMethodRunnable(Object, Method)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>protected</span> Runnable <span style=color:#a6e22e>createRunnable</span><span style=color:#f92672>(</span>Object target<span style=color:#f92672>,</span> Method method<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(</span>method<span style=color:#f92672>.</span><span style=color:#a6e22e>getParameterCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Only no-arg methods may be annotated with @Scheduled&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		Method invocableMethod <span style=color:#f92672>=</span> AopUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>selectInvocableMethod</span><span style=color:#f92672>(</span>method<span style=color:#f92672>,</span> target<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ScheduledMethodRunnable<span style=color:#f92672>(</span>target<span style=color:#f92672>,</span> invocableMethod<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>convertToMillis</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> value<span style=color:#f92672>,</span> TimeUnit timeUnit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>.</span><span style=color:#a6e22e>convert</span><span style=color:#f92672>(</span>value<span style=color:#f92672>,</span> timeUnit<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>convertToMillis</span><span style=color:#f92672>(</span>String value<span style=color:#f92672>,</span> TimeUnit timeUnit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>isDurationString<span style=color:#f92672>(</span>value<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> Duration<span style=color:#f92672>.</span><span style=color:#a6e22e>parse</span><span style=color:#f92672>(</span>value<span style=color:#f92672>).</span><span style=color:#a6e22e>toMillis</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> convertToMillis<span style=color:#f92672>(</span>Long<span style=color:#f92672>.</span><span style=color:#a6e22e>parseLong</span><span style=color:#f92672>(</span>value<span style=color:#f92672>),</span> timeUnit<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isDurationString</span><span style=color:#f92672>(</span>String value<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>value<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>isP<span style=color:#f92672>(</span>value<span style=color:#f92672>.</span><span style=color:#a6e22e>charAt</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span><span style=color:#f92672>))</span> <span style=color:#f92672>||</span> isP<span style=color:#f92672>(</span>value<span style=color:#f92672>.</span><span style=color:#a6e22e>charAt</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>))));</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isP</span><span style=color:#f92672>(</span><span style=color:#66d9ef>char</span> ch<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>ch <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;P&#39;</span> <span style=color:#f92672>||</span> ch <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;p&#39;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Return all currently scheduled tasks, from {@link Scheduled} methods
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * as well as from programmatic {@link SchedulingConfigurer} interaction.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 5.0.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getScheduledTasks</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedHashSet<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			Collection<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;&gt;</span> allTasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> tasks <span style=color:#f92672>:</span> allTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				result<span style=color:#f92672>.</span><span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>tasks<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		result<span style=color:#f92672>.</span><span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getScheduledTasks</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> result<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>postProcessBeforeDestruction</span><span style=color:#f92672>(</span>Object bean<span style=color:#f92672>,</span> String beanName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> tasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			tasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>bean<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>tasks <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>ScheduledTask task <span style=color:#f92672>:</span> tasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				task<span style=color:#f92672>.</span><span style=color:#a6e22e>cancel</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>requiresDestruction</span><span style=color:#f92672>(</span>Object bean<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span>bean<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>destroy</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			Collection<span style=color:#f92672>&lt;</span>Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;&gt;</span> allTasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>values</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> tasks <span style=color:#f92672>:</span> allTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>ScheduledTask task <span style=color:#f92672>:</span> tasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					task<span style=color:#f92672>.</span><span style=color:#a6e22e>cancel</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clear</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registrar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>destroy</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>第二个关键类</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Helper bean for registering tasks with a {@link TaskScheduler}, typically using cron
</span></span></span><span style=display:flex><span><span style=color:#75715e> * expressions.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;As of Spring 3.1, {@code ScheduledTaskRegistrar} has a more prominent user-facing
</span></span></span><span style=display:flex><span><span style=color:#75715e> * role when used in conjunction with the {@link
</span></span></span><span style=display:flex><span><span style=color:#75715e> * org.springframework.scheduling.annotation.EnableAsync @EnableAsync} annotation and its
</span></span></span><span style=display:flex><span><span style=color:#75715e> * {@link org.springframework.scheduling.annotation.SchedulingConfigurer
</span></span></span><span style=display:flex><span><span style=color:#75715e> * SchedulingConfigurer} callback interface.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Juergen Hoeller
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Chris Beams
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Tobias Montagna-Hay
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Sam Brannen
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @since 3.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see org.springframework.scheduling.annotation.EnableAsync
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @see org.springframework.scheduling.annotation.SchedulingConfigurer
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ScheduledTaskRegistrar</span> <span style=color:#66d9ef>implements</span> ScheduledTaskHolder<span style=color:#f92672>,</span> InitializingBean<span style=color:#f92672>,</span> DisposableBean <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * A special cron expression value that indicates a disabled trigger: {@value}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * &lt;p&gt;This is primarily meant for use with {@link #addCronTask(Runnable, String)}
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * when the value for the supplied {@code expression} is retrieved from an
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * external source &amp;mdash; for example, from a property in the
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * {@link org.springframework.core.env.Environment Environment}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 5.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see org.springframework.scheduling.annotation.Scheduled#CRON_DISABLED
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String CRON_DISABLED <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;-&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> TaskScheduler taskScheduler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> ScheduledExecutorService localExecutor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>TriggerTask<span style=color:#f92672>&gt;</span> triggerTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>CronTask<span style=color:#f92672>&gt;</span> cronTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>IntervalTask<span style=color:#f92672>&gt;</span> fixedRateTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>IntervalTask<span style=color:#f92672>&gt;</span> fixedDelayTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>Task<span style=color:#f92672>,</span> ScheduledTask<span style=color:#f92672>&gt;</span> unresolvedTasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;(</span><span style=color:#ae81ff>16</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> scheduledTasks <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedHashSet<span style=color:#f92672>&lt;&gt;(</span><span style=color:#ae81ff>16</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Set the {@link TaskScheduler} to register scheduled tasks with.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setTaskScheduler</span><span style=color:#f92672>(</span>TaskScheduler taskScheduler<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>notNull</span><span style=color:#f92672>(</span>taskScheduler<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;TaskScheduler must not be null&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>=</span> taskScheduler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Set the {@link TaskScheduler} to register scheduled tasks with, or a
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * {@link java.util.concurrent.ScheduledExecutorService} to be wrapped as a
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * {@code TaskScheduler}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setScheduler</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Nullable</span> Object scheduler<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scheduler <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scheduler <span style=color:#66d9ef>instanceof</span> TaskScheduler<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>TaskScheduler<span style=color:#f92672>)</span> scheduler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scheduler <span style=color:#66d9ef>instanceof</span> ScheduledExecutorService<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentTaskScheduler<span style=color:#f92672>(((</span>ScheduledExecutorService<span style=color:#f92672>)</span> scheduler<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Unsupported scheduler type: &#34;</span> <span style=color:#f92672>+</span> scheduler<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Return the {@link TaskScheduler} instance for this registrar (may be {@code null}).
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> TaskScheduler <span style=color:#a6e22e>getScheduler</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify triggered tasks as a Map of Runnables (the tasks) and Trigger objects
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * (typically custom implementations of the {@link Trigger} interface).
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setTriggerTasks</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>Runnable<span style=color:#f92672>,</span> Trigger<span style=color:#f92672>&gt;</span> triggerTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		triggerTasks<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>((</span>task<span style=color:#f92672>,</span> trigger<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> addTriggerTask<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> TriggerTask<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> trigger<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify triggered tasks as a list of {@link TriggerTask} objects. Primarily used
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * by {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setTriggerTasksList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>TriggerTask<span style=color:#f92672>&gt;</span> triggerTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span> <span style=color:#f92672>=</span> triggerTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Get the trigger tasks as an unmodifiable list of {@link TriggerTask} objects.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return the list of tasks (never {@code null})
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>TriggerTask<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getTriggerTaskList</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>?</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>unmodifiableList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>				Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>emptyList</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify triggered tasks as a Map of Runnables (the tasks) and cron expressions.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see CronTrigger
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setCronTasks</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>Runnable<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> cronTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		cronTasks<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>::</span>addCronTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify triggered tasks as a list of {@link CronTask} objects. Primarily used by
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setCronTasksList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>CronTask<span style=color:#f92672>&gt;</span> cronTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span> <span style=color:#f92672>=</span> cronTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Get the cron tasks as an unmodifiable list of {@link CronTask} objects.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return the list of tasks (never {@code null})
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>CronTask<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getCronTaskList</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>unmodifiableList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>				Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>emptyList</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify triggered tasks as a Map of Runnables (the tasks) and fixed-rate values.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setFixedRateTasks</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>Runnable<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> fixedRateTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		fixedRateTasks<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>::</span>addFixedRateTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify fixed-rate tasks as a list of {@link IntervalTask} objects. Primarily used
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * by {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setFixedRateTasksList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>IntervalTask<span style=color:#f92672>&gt;</span> fixedRateTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span> <span style=color:#f92672>=</span> fixedRateTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Get the fixed-rate tasks as an unmodifiable list of {@link IntervalTask} objects.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return the list of tasks (never {@code null})
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>IntervalTask<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getFixedRateTaskList</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>unmodifiableList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>				Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>emptyList</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify triggered tasks as a Map of Runnables (the tasks) and fixed-delay values.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleWithFixedDelay(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setFixedDelayTasks</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>Runnable<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> fixedDelayTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		fixedDelayTasks<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>::</span>addFixedDelayTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Specify fixed-delay tasks as a list of {@link IntervalTask} objects. Primarily used
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * by {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setFixedDelayTasksList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>IntervalTask<span style=color:#f92672>&gt;</span> fixedDelayTasks<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span> <span style=color:#f92672>=</span> fixedDelayTasks<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Get the fixed-delay tasks as an unmodifiable list of {@link IntervalTask} objects.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return the list of tasks (never {@code null})
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>IntervalTask<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getFixedDelayTaskList</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>unmodifiableList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>				Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>emptyList</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a Runnable task to be triggered per the given {@link Trigger}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addTriggerTask</span><span style=color:#f92672>(</span>Runnable task<span style=color:#f92672>,</span> Trigger trigger<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		addTriggerTask<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> TriggerTask<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> trigger<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a {@code TriggerTask}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addTriggerTask</span><span style=color:#f92672>(</span>TriggerTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a {@link Runnable} task to be triggered per the given cron {@code expression}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * &lt;p&gt;As of Spring Framework 5.2, this method will not register the task if the
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * {@code expression} is equal to {@link #CRON_DISABLED}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addCronTask</span><span style=color:#f92672>(</span>Runnable task<span style=color:#f92672>,</span> String expression<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>CRON_DISABLED<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>expression<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			addCronTask<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> CronTask<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> expression<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a {@link CronTask}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addCronTask</span><span style=color:#f92672>(</span>CronTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a {@code Runnable} task to be triggered at the given fixed-rate interval.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addFixedRateTask</span><span style=color:#f92672>(</span>Runnable task<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> interval<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		addFixedRateTask<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> IntervalTask<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> interval<span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a fixed-rate {@link IntervalTask}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addFixedRateTask</span><span style=color:#f92672>(</span>IntervalTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a Runnable task to be triggered with the given fixed delay.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleWithFixedDelay(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addFixedDelayTask</span><span style=color:#f92672>(</span>Runnable task<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> delay<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		addFixedDelayTask<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> IntervalTask<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> delay<span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Add a fixed-delay {@link IntervalTask}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see TaskScheduler#scheduleWithFixedDelay(Runnable, long)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addFixedDelayTask</span><span style=color:#f92672>(</span>IntervalTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Return whether this {@code ScheduledTaskRegistrar} has any tasks registered.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 3.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>hasTasks</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(!</span>CollectionUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>!</span>CollectionUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>!</span>CollectionUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>!</span>CollectionUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Calls {@link #scheduleTasks()} at bean construction time.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>afterPropertiesSet</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		scheduleTasks<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Schedule all registered tasks against the underlying
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * {@linkplain #setTaskScheduler(TaskScheduler) task scheduler}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@SuppressWarnings</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;deprecation&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>scheduleTasks</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>localExecutor</span> <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newSingleThreadScheduledExecutor</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentTaskScheduler<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>localExecutor</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>TriggerTask task <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>triggerTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				addScheduledTask<span style=color:#f92672>(</span>scheduleTriggerTask<span style=color:#f92672>(</span>task<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>CronTask task <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cronTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				addScheduledTask<span style=color:#f92672>(</span>scheduleCronTask<span style=color:#f92672>(</span>task<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>IntervalTask task <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedRateTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				addScheduledTask<span style=color:#f92672>(</span>scheduleFixedRateTask<span style=color:#f92672>(</span>task<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>IntervalTask task <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fixedDelayTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				addScheduledTask<span style=color:#f92672>(</span>scheduleFixedDelayTask<span style=color:#f92672>(</span>task<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addScheduledTask</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Nullable</span> ScheduledTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>task <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Schedule the specified trigger task, either right away if possible
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * or on initialization of the scheduler.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.3
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> ScheduledTask <span style=color:#a6e22e>scheduleTriggerTask</span><span style=color:#f92672>(</span>TriggerTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		ScheduledTask scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>boolean</span> newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scheduledTask <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ScheduledTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			scheduledTask<span style=color:#f92672>.</span><span style=color:#a6e22e>future</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>schedule</span><span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getTrigger</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			addTriggerTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> scheduledTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>newTask <span style=color:#f92672>?</span> scheduledTask <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Schedule the specified cron task, either right away if possible
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * or on initialization of the scheduler.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.3
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> ScheduledTask <span style=color:#a6e22e>scheduleCronTask</span><span style=color:#f92672>(</span>CronTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		ScheduledTask scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>boolean</span> newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scheduledTask <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ScheduledTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			scheduledTask<span style=color:#f92672>.</span><span style=color:#a6e22e>future</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>schedule</span><span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getTrigger</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			addCronTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> scheduledTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>newTask <span style=color:#f92672>?</span> scheduledTask <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Schedule the specified fixed-rate task, either right away if possible
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * or on initialization of the scheduler.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.3
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @deprecated as of 5.0.2, in favor of {@link #scheduleFixedRateTask(FixedRateTask)}
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Deprecated</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> ScheduledTask <span style=color:#a6e22e>scheduleFixedRateTask</span><span style=color:#f92672>(</span>IntervalTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		FixedRateTask taskToUse <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>task <span style=color:#66d9ef>instanceof</span> FixedRateTask <span style=color:#f92672>?</span> <span style=color:#f92672>(</span>FixedRateTask<span style=color:#f92672>)</span> task <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>new</span> FixedRateTask<span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInterval</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInitialDelay</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> scheduleFixedRateTask<span style=color:#f92672>(</span>taskToUse<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Schedule the specified fixed-rate task, either right away if possible
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * or on initialization of the scheduler.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 5.0.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> ScheduledTask <span style=color:#a6e22e>scheduleFixedRateTask</span><span style=color:#f92672>(</span>FixedRateTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		ScheduledTask scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>boolean</span> newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scheduledTask <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ScheduledTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInitialDelay</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				Date startTime <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getClock</span><span style=color:#f92672>().</span><span style=color:#a6e22e>millis</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInitialDelay</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>				scheduledTask<span style=color:#f92672>.</span><span style=color:#a6e22e>future</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleAtFixedRate</span><span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> startTime<span style=color:#f92672>,</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInterval</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				scheduledTask<span style=color:#f92672>.</span><span style=color:#a6e22e>future</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleAtFixedRate</span><span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInterval</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			addFixedRateTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> scheduledTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>newTask <span style=color:#f92672>?</span> scheduledTask <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Schedule the specified fixed-delay task, either right away if possible
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * or on initialization of the scheduler.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 4.3
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @deprecated as of 5.0.2, in favor of {@link #scheduleFixedDelayTask(FixedDelayTask)}
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Deprecated</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> ScheduledTask <span style=color:#a6e22e>scheduleFixedDelayTask</span><span style=color:#f92672>(</span>IntervalTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		FixedDelayTask taskToUse <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>task <span style=color:#66d9ef>instanceof</span> FixedDelayTask <span style=color:#f92672>?</span> <span style=color:#f92672>(</span>FixedDelayTask<span style=color:#f92672>)</span> task <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>new</span> FixedDelayTask<span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInterval</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInitialDelay</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> scheduleFixedDelayTask<span style=color:#f92672>(</span>taskToUse<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Schedule the specified fixed-delay task, either right away if possible
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * or on initialization of the scheduler.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 5.0.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> ScheduledTask <span style=color:#a6e22e>scheduleFixedDelayTask</span><span style=color:#f92672>(</span>FixedDelayTask task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		ScheduledTask scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>boolean</span> newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scheduledTask <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			scheduledTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ScheduledTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			newTask <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInitialDelay</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				Date startTime <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getClock</span><span style=color:#f92672>().</span><span style=color:#a6e22e>millis</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInitialDelay</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>				scheduledTask<span style=color:#f92672>.</span><span style=color:#a6e22e>future</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleWithFixedDelay</span><span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> startTime<span style=color:#f92672>,</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInterval</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				scheduledTask<span style=color:#f92672>.</span><span style=color:#a6e22e>future</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>taskScheduler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduleWithFixedDelay</span><span style=color:#f92672>(</span>task<span style=color:#f92672>.</span><span style=color:#a6e22e>getRunnable</span><span style=color:#f92672>(),</span> task<span style=color:#f92672>.</span><span style=color:#a6e22e>getInterval</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			addFixedDelayTask<span style=color:#f92672>(</span>task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unresolvedTasks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> scheduledTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>newTask <span style=color:#f92672>?</span> scheduledTask <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Return all locally registered tasks that have been scheduled by this registrar.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @since 5.0.2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see #addTriggerTask
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see #addCronTask
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see #addFixedRateTask
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @see #addFixedDelayTask
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Set<span style=color:#f92672>&lt;</span>ScheduledTask<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getScheduledTasks</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>unmodifiableSet</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>destroy</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>ScheduledTask task <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>scheduledTasks</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			task<span style=color:#f92672>.</span><span style=color:#a6e22e>cancel</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>localExecutor</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>localExecutor</span><span style=color:#f92672>.</span><span style=color:#a6e22e>shutdownNow</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h1 id=拓展应用>拓展应用</h1></section><footer class=article-footer></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/posts/2023091506/><div class=article-details><h2 class=article-title>SpringBoot初始化方法</h2></div></a></article><article><a href=/posts/2023091504/><div class=article-details><h2 class=article-title>gRPC</h2></div></a></article><article><a href=/posts/2023091503/><div class=article-details><h2 class=article-title>邀请码实现方案</h2></div></a></article><article><a href=/posts/2023091502/><div class=article-details><h2 class=article-title>雪花算法</h2></div></a></article><article><a href=/posts/2020011501/><div class=article-details><h2 class=article-title>内容分发网络CND</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 雪乃の猫</section><section class=powerby><div style=margin:0><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393>皖ICP备 20012821 号</a>&nbsp; |&nbsp; <span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=34082602201751" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src=/img/beian.png style="float:left;margin:0 5px 0 0">皖公网安备 34082602201751 号</a></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><span class="fa fa-user"></span>&nbsp;
<span id=busuanzi_value_site_uv></span></span>
<span id=busuanzi_container_site_pv class=footer-divider title=总访问量><span class="fa fa-eye"></span>&nbsp;
<span id=busuanzi_value_site_pv></span></span></div><div class="footer-line thanks"><span class="icp footer-divider">特别感谢
<a href=https://gohugo.io target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.111.3">Hugo</a> |
<a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel="noopener noreffer" title="Stack 3.20.0">Stack</a> |
<a href=https://github.com target=_blank rel="noopener noreffer">GitHub</a> |
<a href=https://vercel.com target=_blank rel="noopener noreffer">Vercel</a> |
<a href=https://dashboard.algolia.com target=_blank rel="noopener noreffer">Algolia</a></span></div></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>