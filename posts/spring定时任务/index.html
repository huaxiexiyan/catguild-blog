<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="初认识 基本使用 1、添加基本依赖 2、 @EnableScheduling 注解开启定时任务 @Scheduled 注释标注定时任务方法 通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过task:ann"><title>Spring Task定时任务</title><link rel=canonical href=https://www.catguild.cn/posts/spring%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Spring Task定时任务"><meta property="og:description" content="初认识 基本使用 1、添加基本依赖 2、 @EnableScheduling 注解开启定时任务 @Scheduled 注释标注定时任务方法 通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过task:ann"><meta property="og:url" content="https://www.catguild.cn/posts/spring%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><meta property="og:site_name" content="雪乃の猫"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta name=twitter:title content="Spring Task定时任务"><meta name=twitter:description content="初认识 基本使用 1、添加基本依赖 2、 @EnableScheduling 注解开启定时任务 @Scheduled 注释标注定时任务方法 通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过task:ann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-49K5GYEZX0"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-49K5GYEZX0")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?6e15f273a2871fda1150e7f434efa838",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_huda2458f72ce188392d75c5d51cd8e24e_373_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>雪乃の猫</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><span>⏱时间轴</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>🔖标签</span></a></li><li><a href=/search/><span>🔍搜索</span></a></li><li><a href=/links/><span>🤝友链</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/spring%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/>Spring Task定时任务</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>10 minute read</time></div></footer></div></header><section class=article-content><h1 id=初认识>初认识</h1><h2 id=基本使用>基本使用</h2><h4 id=1添加基本依赖>1、添加基本依赖</h4><h4 id=2>2、</h4><p>@EnableScheduling 注解开启定时任务</p><p>@Scheduled 注释标注定时任务方法</p><p>通过注册ScheduledAnnotationBeanPostProcessor来执行@Scheduled注释的处理。这可以手动完成，或者更方便地通过<a class=link href=task:annotation-driven/>task:annotation-driven/</a>XML元素或@EnableScheduling annotation来完成。</p><h2 id=三种触发器>三种触发器</h2><h3 id=实际运行一下>实际运行一下</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>lombok.extern.slf4j.Slf4j</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.scheduling.annotation.EnableScheduling</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.scheduling.annotation.Scheduled</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.stereotype.Component</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @author xiyan
</span></span></span><span class=line><span class=cl><span class=cm> * @date 2023/7/5 14:36
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableScheduling</span>
</span></span><span class=line><span class=cl><span class=nd>@Component</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DemoScheduledTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 固定延迟时间
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔 5s ，执行 3s、实际间隔8s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:36:05.068
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:36:13.091
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:36:21.109
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:36:29.134
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:36:37.149
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔 5s ，执行 5s、实际间隔10s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:38:46.182
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:38:56.196
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:39:06.210
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:39:16.235
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:39:26.244
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔 5s ，执行 7s、实际间隔12s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:45:02.764
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:45:14.775
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:45:26.796
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:45:38.814
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:45:50.830
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 下次执行时间=上次执行时间+(fixedDelay时间+执行耗时)
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Scheduled</span><span class=o>(</span><span class=n>fixedDelay</span> <span class=o>=</span> <span class=mi>5000</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test1</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;test1方法执行=====&gt;&gt;&gt;&gt;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=mi>3000</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 固定间隔时间
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔5s、执行3s、实际间隔5s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 18:00:11.362
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 18:00:16.352
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 18:00:21.358
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 18:00:26.355
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 18:00:31.364
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔 5s ，执行 5s、实际间隔5s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:40:39.180
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:40:44.185
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:40:49.200
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:40:54.212
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:40:59.226
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔5s，执行7s、实际间隔7s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:41:45.559
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:41:52.567
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:41:59.581
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:42:06.588
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-05 14:42:13.593
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 下次执行时间=上次执行时间+ max(fixedRate, 执行耗时)
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Scheduled</span><span class=o>(</span><span class=n>fixedRate</span> <span class=o>=</span> <span class=mi>5000</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test2</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;test2方法执行=====&gt;&gt;&gt;&gt;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=mi>3000</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * cron表达式
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔5s、执行3s、实际间隔5s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:55:10.015
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:55:15.001
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:55:20.014
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:55:25.007
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:55:30.008
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔 5s ，执行 5s、实际间隔10s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:49:55.008
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:50:05.014
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:50:15.000
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:50:25.004
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:50:35.005
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 间隔5s，执行7s、实际间隔10s
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:51:55.016
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:52:05.008
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:52:15.001
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:52:25.010
</span></span></span><span class=line><span class=cl><span class=cm>     * 2023-07-06 17:52:35.014
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * 下次执行时间=如果到达定时时间，上一个任务已完成，将会执行，否则会跳过
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Scheduled</span><span class=o>(</span><span class=n>cron</span> <span class=o>=</span> <span class=s>&#34;0/5 * * * * ?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test3</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;test3方法执行=====&gt;&gt;&gt;&gt;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=mi>5000</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=为什么会这样>为什么会这样</h3><h1 id=运行原理>运行原理</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>Bean后处理器，注册用@Scheduled注释的方法，以便由TaskScheduler根据通过注释提供的“fixedRate”、“fixedDelay”或“cron”表达式调用。
</span></span></span><span class=line><span class=cl><span class=cm>这个后处理器由Spring的&lt;task:annotation-driven&gt;XML元素以及@EnableScheduling注释自动注册。
</span></span></span><span class=line><span class=cl><span class=cm>自动检测容器中的任何SchedulingConfigurer实例，允许自定义要使用的计划程序或对任务注册进行细粒度控制（例如，注册触发器任务）。
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=n>org</span><span class=o>.</span><span class=na>springframework</span><span class=o>.</span><span class=na>scheduling</span><span class=o>.</span><span class=na>annotation</span><span class=o>.</span><span class=na>ScheduledAnnotationBeanPostProcessor</span>
</span></span></code></pre></div><p>关键类</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Bean post-processor that registers methods annotated with
</span></span></span><span class=line><span class=cl><span class=cm> * {@link Scheduled @Scheduled} to be invoked by a
</span></span></span><span class=line><span class=cl><span class=cm> * {@link org.springframework.scheduling.TaskScheduler} according to the
</span></span></span><span class=line><span class=cl><span class=cm> * &#34;fixedRate&#34;, &#34;fixedDelay&#34;, or &#34;cron&#34; expression provided via the annotation.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * &lt;p&gt;This post-processor is automatically registered by Spring&#39;s
</span></span></span><span class=line><span class=cl><span class=cm> * {@code &lt;task:annotation-driven&gt;} XML element, and also by the
</span></span></span><span class=line><span class=cl><span class=cm> * {@link EnableScheduling @EnableScheduling} annotation.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * &lt;p&gt;Autodetects any {@link SchedulingConfigurer} instances in the container,
</span></span></span><span class=line><span class=cl><span class=cm> * allowing for customization of the scheduler to be used or for fine-grained
</span></span></span><span class=line><span class=cl><span class=cm> * control over task registration (e.g. registration of {@link Trigger} tasks).
</span></span></span><span class=line><span class=cl><span class=cm> * See the {@link EnableScheduling @EnableScheduling} javadocs for complete usage
</span></span></span><span class=line><span class=cl><span class=cm> * details.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @author Mark Fisher
</span></span></span><span class=line><span class=cl><span class=cm> * @author Juergen Hoeller
</span></span></span><span class=line><span class=cl><span class=cm> * @author Chris Beams
</span></span></span><span class=line><span class=cl><span class=cm> * @author Elizabeth Chatman
</span></span></span><span class=line><span class=cl><span class=cm> * @author Victor Brown
</span></span></span><span class=line><span class=cl><span class=cm> * @author Sam Brannen
</span></span></span><span class=line><span class=cl><span class=cm> * @since 3.0
</span></span></span><span class=line><span class=cl><span class=cm> * @see Scheduled
</span></span></span><span class=line><span class=cl><span class=cm> * @see EnableScheduling
</span></span></span><span class=line><span class=cl><span class=cm> * @see SchedulingConfigurer
</span></span></span><span class=line><span class=cl><span class=cm> * @see org.springframework.scheduling.TaskScheduler
</span></span></span><span class=line><span class=cl><span class=cm> * @see org.springframework.scheduling.config.ScheduledTaskRegistrar
</span></span></span><span class=line><span class=cl><span class=cm> * @see AsyncAnnotationBeanPostProcessor
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ScheduledAnnotationBeanPostProcessor</span>
</span></span><span class=line><span class=cl>		<span class=kd>implements</span> <span class=n>ScheduledTaskHolder</span><span class=o>,</span> <span class=n>MergedBeanDefinitionPostProcessor</span><span class=o>,</span> <span class=n>DestructionAwareBeanPostProcessor</span><span class=o>,</span>
</span></span><span class=line><span class=cl>		<span class=n>Ordered</span><span class=o>,</span> <span class=n>EmbeddedValueResolverAware</span><span class=o>,</span> <span class=n>BeanNameAware</span><span class=o>,</span> <span class=n>BeanFactoryAware</span><span class=o>,</span> <span class=n>ApplicationContextAware</span><span class=o>,</span>
</span></span><span class=line><span class=cl>		<span class=n>SmartInitializingSingleton</span><span class=o>,</span> <span class=n>ApplicationListener</span><span class=o>&lt;</span><span class=n>ContextRefreshedEvent</span><span class=o>&gt;,</span> <span class=n>DisposableBean</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * The default name of the {@link TaskScheduler} bean to pick up: {@value}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * &lt;p&gt;Note that the initial lookup happens by type; this is just the fallback
</span></span></span><span class=line><span class=cl><span class=cm>	 * in case of multiple scheduler beans found in the context.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>DEFAULT_TASK_SCHEDULER_BEAN_NAME</span> <span class=o>=</span> <span class=s>&#34;taskScheduler&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kd>final</span> <span class=n>Log</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LogFactory</span><span class=o>.</span><span class=na>getLog</span><span class=o>(</span><span class=n>getClass</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=n>ScheduledTaskRegistrar</span> <span class=n>registrar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>Object</span> <span class=n>scheduler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>StringValueResolver</span> <span class=n>embeddedValueResolver</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>String</span> <span class=n>beanName</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>BeanFactory</span> <span class=n>beanFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>ApplicationContext</span> <span class=n>applicationContext</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Class</span><span class=o>&lt;?&gt;&gt;</span> <span class=n>nonAnnotatedClasses</span> <span class=o>=</span> <span class=n>Collections</span><span class=o>.</span><span class=na>newSetFromMap</span><span class=o>(</span><span class=k>new</span> <span class=n>ConcurrentHashMap</span><span class=o>&lt;&gt;(</span><span class=mi>64</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>,</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;&gt;</span> <span class=n>scheduledTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>IdentityHashMap</span><span class=o>&lt;&gt;(</span><span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Create a default {@code ScheduledAnnotationBeanPostProcessor}.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=nf>ScheduledAnnotationBeanPostProcessor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>registrar</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ScheduledTaskRegistrar</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Create a {@code ScheduledAnnotationBeanPostProcessor} delegating to the
</span></span></span><span class=line><span class=cl><span class=cm>	 * specified {@link ScheduledTaskRegistrar}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @param registrar the ScheduledTaskRegistrar to register {@code @Scheduled}
</span></span></span><span class=line><span class=cl><span class=cm>	 * tasks on
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 5.1
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=nf>ScheduledAnnotationBeanPostProcessor</span><span class=o>(</span><span class=n>ScheduledTaskRegistrar</span> <span class=n>registrar</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>Assert</span><span class=o>.</span><span class=na>notNull</span><span class=o>(</span><span class=n>registrar</span><span class=o>,</span> <span class=s>&#34;ScheduledTaskRegistrar is required&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>registrar</span> <span class=o>=</span> <span class=n>registrar</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>int</span> <span class=nf>getOrder</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>LOWEST_PRECEDENCE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Set the {@link org.springframework.scheduling.TaskScheduler} that will invoke
</span></span></span><span class=line><span class=cl><span class=cm>	 * the scheduled methods, or a {@link java.util.concurrent.ScheduledExecutorService}
</span></span></span><span class=line><span class=cl><span class=cm>	 * to be wrapped as a TaskScheduler.
</span></span></span><span class=line><span class=cl><span class=cm>	 * &lt;p&gt;If not specified, default scheduler resolution will apply: searching for a
</span></span></span><span class=line><span class=cl><span class=cm>	 * unique {@link TaskScheduler} bean in the context, or for a {@link TaskScheduler}
</span></span></span><span class=line><span class=cl><span class=cm>	 * bean named &#34;taskScheduler&#34; otherwise; the same lookup will also be performed for
</span></span></span><span class=line><span class=cl><span class=cm>	 * a {@link ScheduledExecutorService} bean. If neither of the two is resolvable,
</span></span></span><span class=line><span class=cl><span class=cm>	 * a local single-threaded default scheduler will be created within the registrar.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see #DEFAULT_TASK_SCHEDULER_BEAN_NAME
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setScheduler</span><span class=o>(</span><span class=n>Object</span> <span class=n>scheduler</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>scheduler</span> <span class=o>=</span> <span class=n>scheduler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setEmbeddedValueResolver</span><span class=o>(</span><span class=n>StringValueResolver</span> <span class=n>resolver</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span> <span class=o>=</span> <span class=n>resolver</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setBeanName</span><span class=o>(</span><span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>beanName</span> <span class=o>=</span> <span class=n>beanName</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Making a {@link BeanFactory} available is optional; if not set,
</span></span></span><span class=line><span class=cl><span class=cm>	 * {@link SchedulingConfigurer} beans won&#39;t get autodetected and
</span></span></span><span class=line><span class=cl><span class=cm>	 * a {@link #setScheduler scheduler} has to be explicitly configured.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setBeanFactory</span><span class=o>(</span><span class=n>BeanFactory</span> <span class=n>beanFactory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span> <span class=o>=</span> <span class=n>beanFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Setting an {@link ApplicationContext} is optional: If set, registered
</span></span></span><span class=line><span class=cl><span class=cm>	 * tasks will be activated in the {@link ContextRefreshedEvent} phase;
</span></span></span><span class=line><span class=cl><span class=cm>	 * if not set, it will happen at {@link #afterSingletonsInstantiated} time.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setApplicationContext</span><span class=o>(</span><span class=n>ApplicationContext</span> <span class=n>applicationContext</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>applicationContext</span> <span class=o>=</span> <span class=n>applicationContext</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span> <span class=o>=</span> <span class=n>applicationContext</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterSingletonsInstantiated</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Remove resolved singleton classes from cache
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>this</span><span class=o>.</span><span class=na>nonAnnotatedClasses</span><span class=o>.</span><span class=na>clear</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>applicationContext</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// Not running in an ApplicationContext -&gt; register tasks early...
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=n>finishRegistration</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>onApplicationEvent</span><span class=o>(</span><span class=n>ContextRefreshedEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>event</span><span class=o>.</span><span class=na>getApplicationContext</span><span class=o>()</span> <span class=o>==</span> <span class=k>this</span><span class=o>.</span><span class=na>applicationContext</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// Running in an ApplicationContext -&gt; register tasks this late...
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=c1>// giving other ContextRefreshedEvent listeners a chance to perform
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=c1>// their work at the same time (e.g. Spring Batch&#39;s job registration).
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=n>finishRegistration</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * 关键的注册逻辑
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kt>void</span> <span class=nf>finishRegistration</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduler</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>setScheduler</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduler</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>		<span class=c1>// 解析实现了 SchedulingConfigurer 接口的注册类，编程式任务注册
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span> <span class=k>instanceof</span> <span class=n>ListableBeanFactory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>SchedulingConfigurer</span><span class=o>&gt;</span> <span class=n>beans</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>					<span class=o>((</span><span class=n>ListableBeanFactory</span><span class=o>)</span> <span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span><span class=o>).</span><span class=na>getBeansOfType</span><span class=o>(</span><span class=n>SchedulingConfigurer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=n>List</span><span class=o>&lt;</span><span class=n>SchedulingConfigurer</span><span class=o>&gt;</span> <span class=n>configurers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;(</span><span class=n>beans</span><span class=o>.</span><span class=na>values</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=n>AnnotationAwareOrderComparator</span><span class=o>.</span><span class=na>sort</span><span class=o>(</span><span class=n>configurers</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>SchedulingConfigurer</span> <span class=n>configurer</span> <span class=o>:</span> <span class=n>configurers</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>configurer</span><span class=o>.</span><span class=na>configureTasks</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>        <span class=c1>// 如果注册器中有任务，则注册任务
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>hasTasks</span><span class=o>()</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>getScheduler</span><span class=o>()</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Assert</span><span class=o>.</span><span class=na>state</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>,</span> <span class=s>&#34;BeanFactory must be set to find scheduler by type&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=c1>// Search for TaskScheduler bean...
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>setTaskScheduler</span><span class=o>(</span><span class=n>resolveSchedulerBean</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span><span class=o>,</span> <span class=n>TaskScheduler</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=kc>false</span><span class=o>));</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>catch</span> <span class=o>(</span><span class=n>NoUniqueBeanDefinitionException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isTraceEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>logger</span><span class=o>.</span><span class=na>trace</span><span class=o>(</span><span class=s>&#34;Could not find unique TaskScheduler bean - attempting to resolve by name: &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>							<span class=n>ex</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>setTaskScheduler</span><span class=o>(</span><span class=n>resolveSchedulerBean</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span><span class=o>,</span> <span class=n>TaskScheduler</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=kc>true</span><span class=o>));</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchBeanDefinitionException</span> <span class=n>ex2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isInfoEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;More than one TaskScheduler bean exists within the context, and &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;none is named &#39;taskScheduler&#39;. Mark one of them as primary or name it &#39;taskScheduler&#39; &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;(possibly as an alias); or implement the SchedulingConfigurer interface and call &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;ScheduledTaskRegistrar#setScheduler explicitly within the configureTasks() callback: &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>								<span class=n>ex</span><span class=o>.</span><span class=na>getBeanNamesFound</span><span class=o>());</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchBeanDefinitionException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isTraceEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>logger</span><span class=o>.</span><span class=na>trace</span><span class=o>(</span><span class=s>&#34;Could not find default TaskScheduler bean - attempting to find ScheduledExecutorService: &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>							<span class=n>ex</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=c1>// Search for ScheduledExecutorService bean next...
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>setScheduler</span><span class=o>(</span><span class=n>resolveSchedulerBean</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span><span class=o>,</span> <span class=n>ScheduledExecutorService</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=kc>false</span><span class=o>));</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>catch</span> <span class=o>(</span><span class=n>NoUniqueBeanDefinitionException</span> <span class=n>ex2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isTraceEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>logger</span><span class=o>.</span><span class=na>trace</span><span class=o>(</span><span class=s>&#34;Could not find unique ScheduledExecutorService bean - attempting to resolve by name: &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>								<span class=n>ex2</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>setScheduler</span><span class=o>(</span><span class=n>resolveSchedulerBean</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span><span class=o>,</span> <span class=n>ScheduledExecutorService</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=kc>true</span><span class=o>));</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchBeanDefinitionException</span> <span class=n>ex3</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isInfoEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>							<span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;More than one ScheduledExecutorService bean exists within the context, and &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>									<span class=s>&#34;none is named &#39;taskScheduler&#39;. Mark one of them as primary or name it &#39;taskScheduler&#39; &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>									<span class=s>&#34;(possibly as an alias); or implement the SchedulingConfigurer interface and call &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>									<span class=s>&#34;ScheduledTaskRegistrar#setScheduler explicitly within the configureTasks() callback: &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>									<span class=n>ex2</span><span class=o>.</span><span class=na>getBeanNamesFound</span><span class=o>());</span>
</span></span><span class=line><span class=cl>						<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchBeanDefinitionException</span> <span class=n>ex2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isTraceEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>logger</span><span class=o>.</span><span class=na>trace</span><span class=o>(</span><span class=s>&#34;Could not find default ScheduledExecutorService bean - falling back to default: &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>								<span class=n>ex2</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=c1>// Giving up -&gt; falling back to default scheduler within the registrar...
</span></span></span><span class=line><span class=cl><span class=c1></span>					<span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;No TaskScheduler/ScheduledExecutorService bean found for scheduled processing&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>afterPropertiesSet</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>resolveSchedulerBean</span><span class=o>(</span><span class=n>BeanFactory</span> <span class=n>beanFactory</span><span class=o>,</span> <span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>schedulerType</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>byName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>byName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>T</span> <span class=n>scheduler</span> <span class=o>=</span> <span class=n>beanFactory</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=n>DEFAULT_TASK_SCHEDULER_BEAN_NAME</span><span class=o>,</span> <span class=n>schedulerType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanName</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span> <span class=k>instanceof</span> <span class=n>ConfigurableBeanFactory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=o>((</span><span class=n>ConfigurableBeanFactory</span><span class=o>)</span> <span class=k>this</span><span class=o>.</span><span class=na>beanFactory</span><span class=o>).</span><span class=na>registerDependentBean</span><span class=o>(</span>
</span></span><span class=line><span class=cl>						<span class=n>DEFAULT_TASK_SCHEDULER_BEAN_NAME</span><span class=o>,</span> <span class=k>this</span><span class=o>.</span><span class=na>beanName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>scheduler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>beanFactory</span> <span class=k>instanceof</span> <span class=n>AutowireCapableBeanFactory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>NamedBeanHolder</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>holder</span> <span class=o>=</span> <span class=o>((</span><span class=n>AutowireCapableBeanFactory</span><span class=o>)</span> <span class=n>beanFactory</span><span class=o>).</span><span class=na>resolveNamedBean</span><span class=o>(</span><span class=n>schedulerType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>beanName</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>beanFactory</span> <span class=k>instanceof</span> <span class=n>ConfigurableBeanFactory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=o>((</span><span class=n>ConfigurableBeanFactory</span><span class=o>)</span> <span class=n>beanFactory</span><span class=o>).</span><span class=na>registerDependentBean</span><span class=o>(</span><span class=n>holder</span><span class=o>.</span><span class=na>getBeanName</span><span class=o>(),</span> <span class=k>this</span><span class=o>.</span><span class=na>beanName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>holder</span><span class=o>.</span><span class=na>getBeanInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>beanFactory</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=n>schedulerType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>postProcessMergedBeanDefinition</span><span class=o>(</span><span class=n>RootBeanDefinition</span> <span class=n>beanDefinition</span><span class=o>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>beanType</span><span class=o>,</span> <span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>Object</span> <span class=nf>postProcessBeforeInitialization</span><span class=o>(</span><span class=n>Object</span> <span class=n>bean</span><span class=o>,</span> <span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>Object</span> <span class=nf>postProcessAfterInitialization</span><span class=o>(</span><span class=n>Object</span> <span class=n>bean</span><span class=o>,</span> <span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>bean</span> <span class=k>instanceof</span> <span class=n>AopInfrastructureBean</span> <span class=o>||</span> <span class=n>bean</span> <span class=k>instanceof</span> <span class=n>TaskScheduler</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>				<span class=n>bean</span> <span class=k>instanceof</span> <span class=n>ScheduledExecutorService</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// Ignore AOP infrastructure such as scoped proxies.
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>targetClass</span> <span class=o>=</span> <span class=n>AopProxyUtils</span><span class=o>.</span><span class=na>ultimateTargetClass</span><span class=o>(</span><span class=n>bean</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(!</span><span class=k>this</span><span class=o>.</span><span class=na>nonAnnotatedClasses</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>targetClass</span><span class=o>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>				<span class=n>AnnotationUtils</span><span class=o>.</span><span class=na>isCandidateClass</span><span class=o>(</span><span class=n>targetClass</span><span class=o>,</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=n>Scheduled</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Schedules</span><span class=o>.</span><span class=na>class</span><span class=o>)))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Map</span><span class=o>&lt;</span><span class=n>Method</span><span class=o>,</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Scheduled</span><span class=o>&gt;&gt;</span> <span class=n>annotatedMethods</span> <span class=o>=</span> <span class=n>MethodIntrospector</span><span class=o>.</span><span class=na>selectMethods</span><span class=o>(</span><span class=n>targetClass</span><span class=o>,</span>
</span></span><span class=line><span class=cl>					<span class=o>(</span><span class=n>MethodIntrospector</span><span class=o>.</span><span class=na>MetadataLookup</span><span class=o>&lt;</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>Scheduled</span><span class=o>&gt;&gt;)</span> <span class=n>method</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>Set</span><span class=o>&lt;</span><span class=n>Scheduled</span><span class=o>&gt;</span> <span class=n>scheduledAnnotations</span> <span class=o>=</span> <span class=n>AnnotatedElementUtils</span><span class=o>.</span><span class=na>getMergedRepeatableAnnotations</span><span class=o>(</span>
</span></span><span class=line><span class=cl>								<span class=n>method</span><span class=o>,</span> <span class=n>Scheduled</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Schedules</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>						<span class=k>return</span> <span class=o>(!</span><span class=n>scheduledAnnotations</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>()</span> <span class=o>?</span> <span class=n>scheduledAnnotations</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=o>});</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>annotatedMethods</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=k>this</span><span class=o>.</span><span class=na>nonAnnotatedClasses</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>targetClass</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isTraceEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>logger</span><span class=o>.</span><span class=na>trace</span><span class=o>(</span><span class=s>&#34;No @Scheduled annotations found on bean class: &#34;</span> <span class=o>+</span> <span class=n>targetClass</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=c1>// Non-empty set of methods
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=n>annotatedMethods</span><span class=o>.</span><span class=na>forEach</span><span class=o>((</span><span class=n>method</span><span class=o>,</span> <span class=n>scheduledAnnotations</span><span class=o>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>						<span class=n>scheduledAnnotations</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>scheduled</span> <span class=o>-&gt;</span> <span class=n>processScheduled</span><span class=o>(</span><span class=n>scheduled</span><span class=o>,</span> <span class=n>method</span><span class=o>,</span> <span class=n>bean</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>logger</span><span class=o>.</span><span class=na>isTraceEnabled</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>logger</span><span class=o>.</span><span class=na>trace</span><span class=o>(</span><span class=n>annotatedMethods</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34; @Scheduled methods processed on bean &#39;&#34;</span> <span class=o>+</span> <span class=n>beanName</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>							<span class=s>&#34;&#39;: &#34;</span> <span class=o>+</span> <span class=n>annotatedMethods</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Process the given {@code @Scheduled} method declaration on the given bean.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @param scheduled the {@code @Scheduled} annotation
</span></span></span><span class=line><span class=cl><span class=cm>	 * @param method the method that the annotation has been declared on
</span></span></span><span class=line><span class=cl><span class=cm>	 * @param bean the target bean instance
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see #createRunnable(Object, Method)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>processScheduled</span><span class=o>(</span><span class=n>Scheduled</span> <span class=n>scheduled</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span> <span class=n>bean</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Runnable</span> <span class=n>runnable</span> <span class=o>=</span> <span class=n>createRunnable</span><span class=o>(</span><span class=n>bean</span><span class=o>,</span> <span class=n>method</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=kt>boolean</span> <span class=n>processedSchedule</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>			<span class=n>String</span> <span class=n>errorMessage</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>					<span class=s>&#34;Exactly one of the &#39;cron&#39;, &#39;fixedDelay(String)&#39;, or &#39;fixedRate(String)&#39; attributes is required&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>tasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedHashSet</span><span class=o>&lt;&gt;(</span><span class=mi>4</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// Determine initial delay
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=kt>long</span> <span class=n>initialDelay</span> <span class=o>=</span> <span class=n>convertToMillis</span><span class=o>(</span><span class=n>scheduled</span><span class=o>.</span><span class=na>initialDelay</span><span class=o>(),</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>timeUnit</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=n>String</span> <span class=n>initialDelayString</span> <span class=o>=</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>initialDelayString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasText</span><span class=o>(</span><span class=n>initialDelayString</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(</span><span class=n>initialDelay</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=o>,</span> <span class=s>&#34;Specify &#39;initialDelay&#39; or &#39;initialDelayString&#39;, not both&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>initialDelayString</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span><span class=o>.</span><span class=na>resolveStringValue</span><span class=o>(</span><span class=n>initialDelayString</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasLength</span><span class=o>(</span><span class=n>initialDelayString</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>initialDelay</span> <span class=o>=</span> <span class=n>convertToMillis</span><span class=o>(</span><span class=n>initialDelayString</span><span class=o>,</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>timeUnit</span><span class=o>());</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=k>catch</span> <span class=o>(</span><span class=n>RuntimeException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;Invalid initialDelayString value \&#34;&#34;</span> <span class=o>+</span> <span class=n>initialDelayString</span> <span class=o>+</span> <span class=s>&#34;\&#34; - cannot parse into long&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// Check cron expression
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=n>String</span> <span class=n>cron</span> <span class=o>=</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>cron</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasText</span><span class=o>(</span><span class=n>cron</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>String</span> <span class=n>zone</span> <span class=o>=</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>zone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>cron</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span><span class=o>.</span><span class=na>resolveStringValue</span><span class=o>(</span><span class=n>cron</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=n>zone</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span><span class=o>.</span><span class=na>resolveStringValue</span><span class=o>(</span><span class=n>zone</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasLength</span><span class=o>(</span><span class=n>cron</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(</span><span class=n>initialDelay</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=o>,</span> <span class=s>&#34;&#39;initialDelay&#39; not supported for cron triggers&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=n>processedSchedule</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span> <span class=o>(!</span><span class=n>Scheduled</span><span class=o>.</span><span class=na>CRON_DISABLED</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>cron</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>TimeZone</span> <span class=n>timeZone</span><span class=o>;</span>
</span></span><span class=line><span class=cl>						<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasText</span><span class=o>(</span><span class=n>zone</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>							<span class=n>timeZone</span> <span class=o>=</span> <span class=n>StringUtils</span><span class=o>.</span><span class=na>parseTimeZoneString</span><span class=o>(</span><span class=n>zone</span><span class=o>);</span>
</span></span><span class=line><span class=cl>						<span class=o>}</span>
</span></span><span class=line><span class=cl>						<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>							<span class=n>timeZone</span> <span class=o>=</span> <span class=n>TimeZone</span><span class=o>.</span><span class=na>getDefault</span><span class=o>();</span>
</span></span><span class=line><span class=cl>						<span class=o>}</span>
</span></span><span class=line><span class=cl>						<span class=n>tasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>scheduleCronTask</span><span class=o>(</span><span class=k>new</span> <span class=n>CronTask</span><span class=o>(</span><span class=n>runnable</span><span class=o>,</span> <span class=k>new</span> <span class=n>CronTrigger</span><span class=o>(</span><span class=n>cron</span><span class=o>,</span> <span class=n>timeZone</span><span class=o>))));</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// At this point we don&#39;t need to differentiate between initial delay set or not anymore
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>if</span> <span class=o>(</span><span class=n>initialDelay</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>initialDelay</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// Check fixed delay
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=kt>long</span> <span class=n>fixedDelay</span> <span class=o>=</span> <span class=n>convertToMillis</span><span class=o>(</span><span class=n>scheduled</span><span class=o>.</span><span class=na>fixedDelay</span><span class=o>(),</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>timeUnit</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>fixedDelay</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(!</span><span class=n>processedSchedule</span><span class=o>,</span> <span class=n>errorMessage</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=n>processedSchedule</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>				<span class=n>tasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>scheduleFixedDelayTask</span><span class=o>(</span><span class=k>new</span> <span class=n>FixedDelayTask</span><span class=o>(</span><span class=n>runnable</span><span class=o>,</span> <span class=n>fixedDelay</span><span class=o>,</span> <span class=n>initialDelay</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=n>String</span> <span class=n>fixedDelayString</span> <span class=o>=</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>fixedDelayString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasText</span><span class=o>(</span><span class=n>fixedDelayString</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>fixedDelayString</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span><span class=o>.</span><span class=na>resolveStringValue</span><span class=o>(</span><span class=n>fixedDelayString</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasLength</span><span class=o>(</span><span class=n>fixedDelayString</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(!</span><span class=n>processedSchedule</span><span class=o>,</span> <span class=n>errorMessage</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=n>processedSchedule</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>					<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>fixedDelay</span> <span class=o>=</span> <span class=n>convertToMillis</span><span class=o>(</span><span class=n>fixedDelayString</span><span class=o>,</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>timeUnit</span><span class=o>());</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=k>catch</span> <span class=o>(</span><span class=n>RuntimeException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;Invalid fixedDelayString value \&#34;&#34;</span> <span class=o>+</span> <span class=n>fixedDelayString</span> <span class=o>+</span> <span class=s>&#34;\&#34; - cannot parse into long&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=n>tasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>scheduleFixedDelayTask</span><span class=o>(</span><span class=k>new</span> <span class=n>FixedDelayTask</span><span class=o>(</span><span class=n>runnable</span><span class=o>,</span> <span class=n>fixedDelay</span><span class=o>,</span> <span class=n>initialDelay</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// Check fixed rate
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=kt>long</span> <span class=n>fixedRate</span> <span class=o>=</span> <span class=n>convertToMillis</span><span class=o>(</span><span class=n>scheduled</span><span class=o>.</span><span class=na>fixedRate</span><span class=o>(),</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>timeUnit</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>fixedRate</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(!</span><span class=n>processedSchedule</span><span class=o>,</span> <span class=n>errorMessage</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=n>processedSchedule</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>				<span class=n>tasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>scheduleFixedRateTask</span><span class=o>(</span><span class=k>new</span> <span class=n>FixedRateTask</span><span class=o>(</span><span class=n>runnable</span><span class=o>,</span> <span class=n>fixedRate</span><span class=o>,</span> <span class=n>initialDelay</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=n>String</span> <span class=n>fixedRateString</span> <span class=o>=</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>fixedRateString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasText</span><span class=o>(</span><span class=n>fixedRateString</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>fixedRateString</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>embeddedValueResolver</span><span class=o>.</span><span class=na>resolveStringValue</span><span class=o>(</span><span class=n>fixedRateString</span><span class=o>);</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasLength</span><span class=o>(</span><span class=n>fixedRateString</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(!</span><span class=n>processedSchedule</span><span class=o>,</span> <span class=n>errorMessage</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=n>processedSchedule</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>					<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=n>fixedRate</span> <span class=o>=</span> <span class=n>convertToMillis</span><span class=o>(</span><span class=n>fixedRateString</span><span class=o>,</span> <span class=n>scheduled</span><span class=o>.</span><span class=na>timeUnit</span><span class=o>());</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=k>catch</span> <span class=o>(</span><span class=n>RuntimeException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>						<span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;Invalid fixedRateString value \&#34;&#34;</span> <span class=o>+</span> <span class=n>fixedRateString</span> <span class=o>+</span> <span class=s>&#34;\&#34; - cannot parse into long&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>					<span class=o>}</span>
</span></span><span class=line><span class=cl>					<span class=n>tasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>scheduleFixedRateTask</span><span class=o>(</span><span class=k>new</span> <span class=n>FixedRateTask</span><span class=o>(</span><span class=n>runnable</span><span class=o>,</span> <span class=n>fixedRate</span><span class=o>,</span> <span class=n>initialDelay</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// Check whether we had any attribute set
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(</span><span class=n>processedSchedule</span><span class=o>,</span> <span class=n>errorMessage</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// Finally register the scheduled tasks
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=kd>synchronized</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>regTasks</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>.</span><span class=na>computeIfAbsent</span><span class=o>(</span><span class=n>bean</span><span class=o>,</span> <span class=n>key</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>LinkedHashSet</span><span class=o>&lt;&gt;(</span><span class=mi>4</span><span class=o>));</span>
</span></span><span class=line><span class=cl>				<span class=n>regTasks</span><span class=o>.</span><span class=na>addAll</span><span class=o>(</span><span class=n>tasks</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>catch</span> <span class=o>(</span><span class=n>IllegalArgumentException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>					<span class=s>&#34;Encountered invalid @Scheduled method &#39;&#34;</span> <span class=o>+</span> <span class=n>method</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;&#39;: &#34;</span> <span class=o>+</span> <span class=n>ex</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Create a {@link Runnable} for the given bean instance,
</span></span></span><span class=line><span class=cl><span class=cm>	 * calling the specified scheduled method.
</span></span></span><span class=line><span class=cl><span class=cm>	 * &lt;p&gt;The default implementation creates a {@link ScheduledMethodRunnable}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @param target the target bean instance
</span></span></span><span class=line><span class=cl><span class=cm>	 * @param method the scheduled method to call
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 5.1
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see ScheduledMethodRunnable#ScheduledMethodRunnable(Object, Method)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>Runnable</span> <span class=nf>createRunnable</span><span class=o>(</span><span class=n>Object</span> <span class=n>target</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>Assert</span><span class=o>.</span><span class=na>isTrue</span><span class=o>(</span><span class=n>method</span><span class=o>.</span><span class=na>getParameterCount</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span><span class=o>,</span> <span class=s>&#34;Only no-arg methods may be annotated with @Scheduled&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>Method</span> <span class=n>invocableMethod</span> <span class=o>=</span> <span class=n>AopUtils</span><span class=o>.</span><span class=na>selectInvocableMethod</span><span class=o>(</span><span class=n>method</span><span class=o>,</span> <span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>());</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=n>ScheduledMethodRunnable</span><span class=o>(</span><span class=n>target</span><span class=o>,</span> <span class=n>invocableMethod</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>static</span> <span class=kt>long</span> <span class=nf>convertToMillis</span><span class=o>(</span><span class=kt>long</span> <span class=n>value</span><span class=o>,</span> <span class=n>TimeUnit</span> <span class=n>timeUnit</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>TimeUnit</span><span class=o>.</span><span class=na>MILLISECONDS</span><span class=o>.</span><span class=na>convert</span><span class=o>(</span><span class=n>value</span><span class=o>,</span> <span class=n>timeUnit</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>static</span> <span class=kt>long</span> <span class=nf>convertToMillis</span><span class=o>(</span><span class=n>String</span> <span class=n>value</span><span class=o>,</span> <span class=n>TimeUnit</span> <span class=n>timeUnit</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>isDurationString</span><span class=o>(</span><span class=n>value</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>Duration</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>value</span><span class=o>).</span><span class=na>toMillis</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>convertToMillis</span><span class=o>(</span><span class=n>Long</span><span class=o>.</span><span class=na>parseLong</span><span class=o>(</span><span class=n>value</span><span class=o>),</span> <span class=n>timeUnit</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=nf>isDurationString</span><span class=o>(</span><span class=n>String</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>isP</span><span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>0</span><span class=o>))</span> <span class=o>||</span> <span class=n>isP</span><span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>1</span><span class=o>))));</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=nf>isP</span><span class=o>(</span><span class=kt>char</span> <span class=n>ch</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=n>ch</span> <span class=o>==</span> <span class=sc>&#39;P&#39;</span> <span class=o>||</span> <span class=n>ch</span> <span class=o>==</span> <span class=sc>&#39;p&#39;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Return all currently scheduled tasks, from {@link Scheduled} methods
</span></span></span><span class=line><span class=cl><span class=cm>	 * as well as from programmatic {@link SchedulingConfigurer} interaction.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 5.0.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=nf>getScheduledTasks</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedHashSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=kd>synchronized</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Collection</span><span class=o>&lt;</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;&gt;</span> <span class=n>allTasks</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>.</span><span class=na>values</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>tasks</span> <span class=o>:</span> <span class=n>allTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>result</span><span class=o>.</span><span class=na>addAll</span><span class=o>(</span><span class=n>tasks</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=n>result</span><span class=o>.</span><span class=na>addAll</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>getScheduledTasks</span><span class=o>());</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>postProcessBeforeDestruction</span><span class=o>(</span><span class=n>Object</span> <span class=n>bean</span><span class=o>,</span> <span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>tasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=kd>synchronized</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>tasks</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>bean</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>tasks</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>ScheduledTask</span> <span class=n>task</span> <span class=o>:</span> <span class=n>tasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>task</span><span class=o>.</span><span class=na>cancel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>requiresDestruction</span><span class=o>(</span><span class=n>Object</span> <span class=n>bean</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>synchronized</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>bean</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>destroy</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>synchronized</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Collection</span><span class=o>&lt;</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;&gt;</span> <span class=n>allTasks</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>.</span><span class=na>values</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>tasks</span> <span class=o>:</span> <span class=n>allTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=k>for</span> <span class=o>(</span><span class=n>ScheduledTask</span> <span class=n>task</span> <span class=o>:</span> <span class=n>tasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>					<span class=n>task</span><span class=o>.</span><span class=na>cancel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>				<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>.</span><span class=na>clear</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>registrar</span><span class=o>.</span><span class=na>destroy</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>第二个关键类</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Helper bean for registering tasks with a {@link TaskScheduler}, typically using cron
</span></span></span><span class=line><span class=cl><span class=cm> * expressions.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * &lt;p&gt;As of Spring 3.1, {@code ScheduledTaskRegistrar} has a more prominent user-facing
</span></span></span><span class=line><span class=cl><span class=cm> * role when used in conjunction with the {@link
</span></span></span><span class=line><span class=cl><span class=cm> * org.springframework.scheduling.annotation.EnableAsync @EnableAsync} annotation and its
</span></span></span><span class=line><span class=cl><span class=cm> * {@link org.springframework.scheduling.annotation.SchedulingConfigurer
</span></span></span><span class=line><span class=cl><span class=cm> * SchedulingConfigurer} callback interface.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @author Juergen Hoeller
</span></span></span><span class=line><span class=cl><span class=cm> * @author Chris Beams
</span></span></span><span class=line><span class=cl><span class=cm> * @author Tobias Montagna-Hay
</span></span></span><span class=line><span class=cl><span class=cm> * @author Sam Brannen
</span></span></span><span class=line><span class=cl><span class=cm> * @since 3.0
</span></span></span><span class=line><span class=cl><span class=cm> * @see org.springframework.scheduling.annotation.EnableAsync
</span></span></span><span class=line><span class=cl><span class=cm> * @see org.springframework.scheduling.annotation.SchedulingConfigurer
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ScheduledTaskRegistrar</span> <span class=kd>implements</span> <span class=n>ScheduledTaskHolder</span><span class=o>,</span> <span class=n>InitializingBean</span><span class=o>,</span> <span class=n>DisposableBean</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * A special cron expression value that indicates a disabled trigger: {@value}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * &lt;p&gt;This is primarily meant for use with {@link #addCronTask(Runnable, String)}
</span></span></span><span class=line><span class=cl><span class=cm>	 * when the value for the supplied {@code expression} is retrieved from an
</span></span></span><span class=line><span class=cl><span class=cm>	 * external source &amp;mdash; for example, from a property in the
</span></span></span><span class=line><span class=cl><span class=cm>	 * {@link org.springframework.core.env.Environment Environment}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 5.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see org.springframework.scheduling.annotation.Scheduled#CRON_DISABLED
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>CRON_DISABLED</span> <span class=o>=</span> <span class=s>&#34;-&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>TaskScheduler</span> <span class=n>taskScheduler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>ScheduledExecutorService</span> <span class=n>localExecutor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>TriggerTask</span><span class=o>&gt;</span> <span class=n>triggerTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>CronTask</span><span class=o>&gt;</span> <span class=n>cronTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>IntervalTask</span><span class=o>&gt;</span> <span class=n>fixedRateTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>IntervalTask</span><span class=o>&gt;</span> <span class=n>fixedDelayTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>,</span> <span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>unresolvedTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;(</span><span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=n>scheduledTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedHashSet</span><span class=o>&lt;&gt;(</span><span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Set the {@link TaskScheduler} to register scheduled tasks with.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setTaskScheduler</span><span class=o>(</span><span class=n>TaskScheduler</span> <span class=n>taskScheduler</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>Assert</span><span class=o>.</span><span class=na>notNull</span><span class=o>(</span><span class=n>taskScheduler</span><span class=o>,</span> <span class=s>&#34;TaskScheduler must not be null&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>=</span> <span class=n>taskScheduler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Set the {@link TaskScheduler} to register scheduled tasks with, or a
</span></span></span><span class=line><span class=cl><span class=cm>	 * {@link java.util.concurrent.ScheduledExecutorService} to be wrapped as a
</span></span></span><span class=line><span class=cl><span class=cm>	 * {@code TaskScheduler}.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setScheduler</span><span class=o>(</span><span class=nd>@Nullable</span> <span class=n>Object</span> <span class=n>scheduler</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>scheduler</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>scheduler</span> <span class=k>instanceof</span> <span class=n>TaskScheduler</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>=</span> <span class=o>(</span><span class=n>TaskScheduler</span><span class=o>)</span> <span class=n>scheduler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>scheduler</span> <span class=k>instanceof</span> <span class=n>ScheduledExecutorService</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcurrentTaskScheduler</span><span class=o>(((</span><span class=n>ScheduledExecutorService</span><span class=o>)</span> <span class=n>scheduler</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Unsupported scheduler type: &#34;</span> <span class=o>+</span> <span class=n>scheduler</span><span class=o>.</span><span class=na>getClass</span><span class=o>());</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Return the {@link TaskScheduler} instance for this registrar (may be {@code null}).
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>TaskScheduler</span> <span class=nf>getScheduler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify triggered tasks as a Map of Runnables (the tasks) and Trigger objects
</span></span></span><span class=line><span class=cl><span class=cm>	 * (typically custom implementations of the {@link Trigger} interface).
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setTriggerTasks</span><span class=o>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>,</span> <span class=n>Trigger</span><span class=o>&gt;</span> <span class=n>triggerTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>triggerTasks</span><span class=o>.</span><span class=na>forEach</span><span class=o>((</span><span class=n>task</span><span class=o>,</span> <span class=n>trigger</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>addTriggerTask</span><span class=o>(</span><span class=k>new</span> <span class=n>TriggerTask</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>trigger</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify triggered tasks as a list of {@link TriggerTask} objects. Primarily used
</span></span></span><span class=line><span class=cl><span class=cm>	 * by {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setTriggerTasksList</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>TriggerTask</span><span class=o>&gt;</span> <span class=n>triggerTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span> <span class=o>=</span> <span class=n>triggerTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Get the trigger tasks as an unmodifiable list of {@link TriggerTask} objects.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return the list of tasks (never {@code null})
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>TriggerTask</span><span class=o>&gt;</span> <span class=nf>getTriggerTaskList</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>?</span> <span class=n>Collections</span><span class=o>.</span><span class=na>unmodifiableList</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span><span class=o>)</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=n>Collections</span><span class=o>.</span><span class=na>emptyList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify triggered tasks as a Map of Runnables (the tasks) and cron expressions.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see CronTrigger
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setCronTasks</span><span class=o>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>cronTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>cronTasks</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>addCronTask</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify triggered tasks as a list of {@link CronTask} objects. Primarily used by
</span></span></span><span class=line><span class=cl><span class=cm>	 * {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setCronTasksList</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>CronTask</span><span class=o>&gt;</span> <span class=n>cronTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span> <span class=o>=</span> <span class=n>cronTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Get the cron tasks as an unmodifiable list of {@link CronTask} objects.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return the list of tasks (never {@code null})
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>CronTask</span><span class=o>&gt;</span> <span class=nf>getCronTaskList</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=n>Collections</span><span class=o>.</span><span class=na>unmodifiableList</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span><span class=o>)</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=n>Collections</span><span class=o>.</span><span class=na>emptyList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify triggered tasks as a Map of Runnables (the tasks) and fixed-rate values.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setFixedRateTasks</span><span class=o>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>,</span> <span class=n>Long</span><span class=o>&gt;</span> <span class=n>fixedRateTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>fixedRateTasks</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>addFixedRateTask</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify fixed-rate tasks as a list of {@link IntervalTask} objects. Primarily used
</span></span></span><span class=line><span class=cl><span class=cm>	 * by {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setFixedRateTasksList</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>IntervalTask</span><span class=o>&gt;</span> <span class=n>fixedRateTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span> <span class=o>=</span> <span class=n>fixedRateTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Get the fixed-rate tasks as an unmodifiable list of {@link IntervalTask} objects.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return the list of tasks (never {@code null})
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>IntervalTask</span><span class=o>&gt;</span> <span class=nf>getFixedRateTaskList</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=n>Collections</span><span class=o>.</span><span class=na>unmodifiableList</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span><span class=o>)</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=n>Collections</span><span class=o>.</span><span class=na>emptyList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify triggered tasks as a Map of Runnables (the tasks) and fixed-delay values.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleWithFixedDelay(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setFixedDelayTasks</span><span class=o>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>,</span> <span class=n>Long</span><span class=o>&gt;</span> <span class=n>fixedDelayTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>fixedDelayTasks</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>addFixedDelayTask</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Specify fixed-delay tasks as a list of {@link IntervalTask} objects. Primarily used
</span></span></span><span class=line><span class=cl><span class=cm>	 * by {@code &lt;task:*&gt;} namespace parsing.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see ScheduledTasksBeanDefinitionParser
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setFixedDelayTasksList</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>IntervalTask</span><span class=o>&gt;</span> <span class=n>fixedDelayTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span> <span class=o>=</span> <span class=n>fixedDelayTasks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Get the fixed-delay tasks as an unmodifiable list of {@link IntervalTask} objects.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return the list of tasks (never {@code null})
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>IntervalTask</span><span class=o>&gt;</span> <span class=nf>getFixedDelayTaskList</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=n>Collections</span><span class=o>.</span><span class=na>unmodifiableList</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span><span class=o>)</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=n>Collections</span><span class=o>.</span><span class=na>emptyList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a Runnable task to be triggered per the given {@link Trigger}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addTriggerTask</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>task</span><span class=o>,</span> <span class=n>Trigger</span> <span class=n>trigger</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>addTriggerTask</span><span class=o>(</span><span class=k>new</span> <span class=n>TriggerTask</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>trigger</span><span class=o>));</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a {@code TriggerTask}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addTriggerTask</span><span class=o>(</span><span class=n>TriggerTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a {@link Runnable} task to be triggered per the given cron {@code expression}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * &lt;p&gt;As of Spring Framework 5.2, this method will not register the task if the
</span></span></span><span class=line><span class=cl><span class=cm>	 * {@code expression} is equal to {@link #CRON_DISABLED}.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addCronTask</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>task</span><span class=o>,</span> <span class=n>String</span> <span class=n>expression</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(!</span><span class=n>CRON_DISABLED</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>expression</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>addCronTask</span><span class=o>(</span><span class=k>new</span> <span class=n>CronTask</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>expression</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a {@link CronTask}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addCronTask</span><span class=o>(</span><span class=n>CronTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a {@code Runnable} task to be triggered at the given fixed-rate interval.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addFixedRateTask</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>task</span><span class=o>,</span> <span class=kt>long</span> <span class=n>interval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>addFixedRateTask</span><span class=o>(</span><span class=k>new</span> <span class=n>IntervalTask</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>interval</span><span class=o>,</span> <span class=mi>0</span><span class=o>));</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a fixed-rate {@link IntervalTask}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleAtFixedRate(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addFixedRateTask</span><span class=o>(</span><span class=n>IntervalTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a Runnable task to be triggered with the given fixed delay.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleWithFixedDelay(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addFixedDelayTask</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>task</span><span class=o>,</span> <span class=kt>long</span> <span class=n>delay</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>addFixedDelayTask</span><span class=o>(</span><span class=k>new</span> <span class=n>IntervalTask</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>delay</span><span class=o>,</span> <span class=mi>0</span><span class=o>));</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Add a fixed-delay {@link IntervalTask}.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see TaskScheduler#scheduleWithFixedDelay(Runnable, long)
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>addFixedDelayTask</span><span class=o>(</span><span class=n>IntervalTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Return whether this {@code ScheduledTaskRegistrar} has any tasks registered.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 3.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>hasTasks</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(!</span><span class=n>CollectionUtils</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span><span class=o>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>				<span class=o>!</span><span class=n>CollectionUtils</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span><span class=o>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>				<span class=o>!</span><span class=n>CollectionUtils</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span><span class=o>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>				<span class=o>!</span><span class=n>CollectionUtils</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span><span class=o>));</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Calls {@link #scheduleTasks()} at bean construction time.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterPropertiesSet</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>scheduleTasks</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Schedule all registered tasks against the underlying
</span></span></span><span class=line><span class=cl><span class=cm>	 * {@linkplain #setTaskScheduler(TaskScheduler) task scheduler}.
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@SuppressWarnings</span><span class=o>(</span><span class=s>&#34;deprecation&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>scheduleTasks</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>localExecutor</span> <span class=o>=</span> <span class=n>Executors</span><span class=o>.</span><span class=na>newSingleThreadScheduledExecutor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcurrentTaskScheduler</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>localExecutor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>TriggerTask</span> <span class=n>task</span> <span class=o>:</span> <span class=k>this</span><span class=o>.</span><span class=na>triggerTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>addScheduledTask</span><span class=o>(</span><span class=n>scheduleTriggerTask</span><span class=o>(</span><span class=n>task</span><span class=o>));</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>CronTask</span> <span class=n>task</span> <span class=o>:</span> <span class=k>this</span><span class=o>.</span><span class=na>cronTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>addScheduledTask</span><span class=o>(</span><span class=n>scheduleCronTask</span><span class=o>(</span><span class=n>task</span><span class=o>));</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>IntervalTask</span> <span class=n>task</span> <span class=o>:</span> <span class=k>this</span><span class=o>.</span><span class=na>fixedRateTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>addScheduledTask</span><span class=o>(</span><span class=n>scheduleFixedRateTask</span><span class=o>(</span><span class=n>task</span><span class=o>));</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=o>(</span><span class=n>IntervalTask</span> <span class=n>task</span> <span class=o>:</span> <span class=k>this</span><span class=o>.</span><span class=na>fixedDelayTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>addScheduledTask</span><span class=o>(</span><span class=n>scheduleFixedDelayTask</span><span class=o>(</span><span class=n>task</span><span class=o>));</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kt>void</span> <span class=nf>addScheduledTask</span><span class=o>(</span><span class=nd>@Nullable</span> <span class=n>ScheduledTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>task</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Schedule the specified trigger task, either right away if possible
</span></span></span><span class=line><span class=cl><span class=cm>	 * or on initialization of the scheduler.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.3
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>ScheduledTask</span> <span class=nf>scheduleTriggerTask</span><span class=o>(</span><span class=n>TriggerTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>ScheduledTask</span> <span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=kt>boolean</span> <span class=n>newTask</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>scheduledTask</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ScheduledTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=n>newTask</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>scheduledTask</span><span class=o>.</span><span class=na>future</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>schedule</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getTrigger</span><span class=o>());</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>addTriggerTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>scheduledTask</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=n>newTask</span> <span class=o>?</span> <span class=n>scheduledTask</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Schedule the specified cron task, either right away if possible
</span></span></span><span class=line><span class=cl><span class=cm>	 * or on initialization of the scheduler.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span class=line><span class=cl><span class=cm>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.3
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>ScheduledTask</span> <span class=nf>scheduleCronTask</span><span class=o>(</span><span class=n>CronTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>ScheduledTask</span> <span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=kt>boolean</span> <span class=n>newTask</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>scheduledTask</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ScheduledTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=n>newTask</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>scheduledTask</span><span class=o>.</span><span class=na>future</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>schedule</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getTrigger</span><span class=o>());</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>addCronTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>scheduledTask</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=n>newTask</span> <span class=o>?</span> <span class=n>scheduledTask</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Schedule the specified fixed-rate task, either right away if possible
</span></span></span><span class=line><span class=cl><span class=cm>	 * or on initialization of the scheduler.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span class=line><span class=cl><span class=cm>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.3
</span></span></span><span class=line><span class=cl><span class=cm>	 * @deprecated as of 5.0.2, in favor of {@link #scheduleFixedRateTask(FixedRateTask)}
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Deprecated</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>ScheduledTask</span> <span class=nf>scheduleFixedRateTask</span><span class=o>(</span><span class=n>IntervalTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>FixedRateTask</span> <span class=n>taskToUse</span> <span class=o>=</span> <span class=o>(</span><span class=n>task</span> <span class=k>instanceof</span> <span class=n>FixedRateTask</span> <span class=o>?</span> <span class=o>(</span><span class=n>FixedRateTask</span><span class=o>)</span> <span class=n>task</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=k>new</span> <span class=n>FixedRateTask</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getInterval</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getInitialDelay</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>scheduleFixedRateTask</span><span class=o>(</span><span class=n>taskToUse</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Schedule the specified fixed-rate task, either right away if possible
</span></span></span><span class=line><span class=cl><span class=cm>	 * or on initialization of the scheduler.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span class=line><span class=cl><span class=cm>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 5.0.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>ScheduledTask</span> <span class=nf>scheduleFixedRateTask</span><span class=o>(</span><span class=n>FixedRateTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>ScheduledTask</span> <span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=kt>boolean</span> <span class=n>newTask</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>scheduledTask</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ScheduledTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=n>newTask</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getInitialDelay</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>Date</span> <span class=n>startTime</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Date</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>getClock</span><span class=o>().</span><span class=na>millis</span><span class=o>()</span> <span class=o>+</span> <span class=n>task</span><span class=o>.</span><span class=na>getInitialDelay</span><span class=o>());</span>
</span></span><span class=line><span class=cl>				<span class=n>scheduledTask</span><span class=o>.</span><span class=na>future</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>						<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>scheduleAtFixedRate</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>startTime</span><span class=o>,</span> <span class=n>task</span><span class=o>.</span><span class=na>getInterval</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>scheduledTask</span><span class=o>.</span><span class=na>future</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>						<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>scheduleAtFixedRate</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getInterval</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>addFixedRateTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>scheduledTask</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=n>newTask</span> <span class=o>?</span> <span class=n>scheduledTask</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Schedule the specified fixed-delay task, either right away if possible
</span></span></span><span class=line><span class=cl><span class=cm>	 * or on initialization of the scheduler.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span class=line><span class=cl><span class=cm>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 4.3
</span></span></span><span class=line><span class=cl><span class=cm>	 * @deprecated as of 5.0.2, in favor of {@link #scheduleFixedDelayTask(FixedDelayTask)}
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Deprecated</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>ScheduledTask</span> <span class=nf>scheduleFixedDelayTask</span><span class=o>(</span><span class=n>IntervalTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>FixedDelayTask</span> <span class=n>taskToUse</span> <span class=o>=</span> <span class=o>(</span><span class=n>task</span> <span class=k>instanceof</span> <span class=n>FixedDelayTask</span> <span class=o>?</span> <span class=o>(</span><span class=n>FixedDelayTask</span><span class=o>)</span> <span class=n>task</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=k>new</span> <span class=n>FixedDelayTask</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getInterval</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getInitialDelay</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>scheduleFixedDelayTask</span><span class=o>(</span><span class=n>taskToUse</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Schedule the specified fixed-delay task, either right away if possible
</span></span></span><span class=line><span class=cl><span class=cm>	 * or on initialization of the scheduler.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return a handle to the scheduled task, allowing to cancel it
</span></span></span><span class=line><span class=cl><span class=cm>	 * (or {@code null} if processing a previously registered task)
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 5.0.2
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>ScheduledTask</span> <span class=nf>scheduleFixedDelayTask</span><span class=o>(</span><span class=n>FixedDelayTask</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>ScheduledTask</span> <span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=kt>boolean</span> <span class=n>newTask</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>scheduledTask</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>scheduledTask</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ScheduledTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=n>newTask</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getInitialDelay</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>Date</span> <span class=n>startTime</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Date</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>getClock</span><span class=o>().</span><span class=na>millis</span><span class=o>()</span> <span class=o>+</span> <span class=n>task</span><span class=o>.</span><span class=na>getInitialDelay</span><span class=o>());</span>
</span></span><span class=line><span class=cl>				<span class=n>scheduledTask</span><span class=o>.</span><span class=na>future</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>						<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>scheduleWithFixedDelay</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>startTime</span><span class=o>,</span> <span class=n>task</span><span class=o>.</span><span class=na>getInterval</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=n>scheduledTask</span><span class=o>.</span><span class=na>future</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>						<span class=k>this</span><span class=o>.</span><span class=na>taskScheduler</span><span class=o>.</span><span class=na>scheduleWithFixedDelay</span><span class=o>(</span><span class=n>task</span><span class=o>.</span><span class=na>getRunnable</span><span class=o>(),</span> <span class=n>task</span><span class=o>.</span><span class=na>getInterval</span><span class=o>());</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>addFixedDelayTask</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>unresolvedTasks</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>scheduledTask</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>(</span><span class=n>newTask</span> <span class=o>?</span> <span class=n>scheduledTask</span> <span class=o>:</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * Return all locally registered tasks that have been scheduled by this registrar.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @since 5.0.2
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see #addTriggerTask
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see #addCronTask
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see #addFixedRateTask
</span></span></span><span class=line><span class=cl><span class=cm>	 * @see #addFixedDelayTask
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>ScheduledTask</span><span class=o>&gt;</span> <span class=nf>getScheduledTasks</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>Collections</span><span class=o>.</span><span class=na>unmodifiableSet</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>destroy</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=o>(</span><span class=n>ScheduledTask</span> <span class=n>task</span> <span class=o>:</span> <span class=k>this</span><span class=o>.</span><span class=na>scheduledTasks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>task</span><span class=o>.</span><span class=na>cancel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>localExecutor</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>localExecutor</span><span class=o>.</span><span class=na>shutdownNow</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=拓展应用>拓展应用</h1></section><footer class=article-footer></footer></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 雪乃の猫</section><section class=powerby><div style=margin:0><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393>皖ICP备 20012821 号</a>&nbsp;<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=34082602201751" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src=/img/beian.png style="float:left;margin:0 5px 0 0">皖公网安备 34082602201751 号</a></span></div><div class="footer-line thanks"><span class="icp footer-divider">特别感谢
<a href=https://gohugo.io target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.111.3">Hugo</a> |
<a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel="noopener noreffer" title="Stack 3.20.0">Stack</a> |
<a href=https://github.com target=_blank rel="noopener noreffer">GitHub</a> |
<a href=https://vercel.com target=_blank rel="noopener noreffer">Vercel</a></span></div></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>